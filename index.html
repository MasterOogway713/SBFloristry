<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <meta name="description" content="SB Floristry is a premier mother and daughter florist team serving Essex and London.">
    <title>SB Floristry | Essex & London's Premier Mother-Daughter Florists</title>
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400&family=Playfair+Display:ital,wght@0,300;0,400;0,500;1,400&display=swap" rel="stylesheet">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: { 'sb-black': '#0a0a0a', 'sb-gold': '#D4AF37', 'sb-cream': '#F9F8F6', 'sb-dark': '#1A1A1A' },
                    fontFamily: { serif: ['"Playfair Display"', 'serif'], sans: ['"Lato"', 'sans-serif'] },
                    letterSpacing: { 'luxury': '0.25em', 'super-wide': '0.35em' },
                    animation: { 'fade-in-up': 'fadeInUp 1.2s ease-out forwards', 'fade-in': 'fadeIn 1s ease-out forwards' },
                    keyframes: {
                        fadeInUp: { '0%': { opacity: '0', transform: 'translateY(20px)' }, '100%': { opacity: '1', transform: 'translateY(0)' } },
                        fadeIn: { '0%': { opacity: '0' }, '100%': { opacity: '1' } }
                    }
                }
            }
        }
    </script>

    <style>
        .hero-zoom { animation: slowZoom 25s infinite alternate; }
        @keyframes slowZoom { from { transform: scale(1); } to { transform: scale(1.05); } }

        .bg-gold-shimmer {
            background: linear-gradient(90deg, #997b3a 0%, #b89546 25%, #D4AF37 50%, #b89546 75%, #997b3a 100%);
            background-size: 200% auto; animation: subtleShimmer 8s linear infinite;
        }
        @keyframes subtleShimmer { 0% { background-position: 0% 50%; } 100% { background-position: 100% 50%; } }

        .reveal { opacity: 0; transform: translateY(30px); transition: all 1s ease-out; }
        .reveal.active { opacity: 1; transform: translateY(0); }
        
        img { opacity: 0; transition: opacity 1.2s ease-out; }
        img.loaded { opacity: 1 !important; }
        
        .btn-luxury { position: relative; overflow: hidden; transition: color 0.4s; z-index: 1; }
        .btn-luxury::before {
            content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background-color: #D4AF37; z-index: -1; transform: scaleY(0); transform-origin: bottom;
            transition: transform 0.4s cubic-bezier(0.19, 1, 0.22, 1);
        }
        .btn-luxury:hover::before { transform: scaleY(1); }
        .btn-luxury:hover { color: #0a0a0a !important; border-color: #D4AF37; }

        .view-section { display: none; opacity: 0; transition: opacity 0.8s ease-in-out; }
        .view-section.active-view { display: block; opacity: 1; animation: fadeIn 1.2s ease-out forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .nav-dropdown { opacity: 0; visibility: hidden; transform: translateY(10px); transition: all 0.3s ease-in-out; }
        .group:hover .nav-dropdown { opacity: 1; visibility: visible; transform: translateY(0); }
        .cart-overlay { background-color: rgba(0,0,0,0.3); backdrop-filter: blur(4px); }
        
        .mobile-accordion-content { max-height: 0; overflow: hidden; transition: max-height 0.3s ease-out; }
        .mobile-accordion-btn.active + .mobile-accordion-content { max-height: 500px; }
        .mobile-accordion-btn.active i { transform: rotate(180deg); }
        
        .loader {
            border: 2px solid #f3f3f3; border-top: 2px solid #D4AF37; border-radius: 50%;
            width: 24px; height: 24px; animation: spin 1s linear infinite; margin: 20px auto;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* Custom Datepicker Styles */
        .calendar-day { transition: all 0.2s; }
        .calendar-day:not(.disabled):hover { background-color: #F9F8F6; color: #D4AF37; border: 1px solid #D4AF37; }
        .calendar-day.selected { background-color: #D4AF37; color: #0a0a0a; border: 1px solid #D4AF37; font-weight: bold; }
        .calendar-day.disabled { color: #e5e7eb; pointer-events: none; background-color: #f9fafb; text-decoration: line-through; opacity: 0.5; }
    </style>
</head>
<body class="font-sans text-sb-dark antialiased bg-sb-cream flex flex-col min-h-screen">

    <!-- Announcement Bar -->
    <div class="bg-gold-shimmer text-sb-black text-[10px] py-2.5 px-4 text-center tracking-[0.25em] uppercase font-bold border-b border-sb-cream/20">
        <p>Family Run • Free delivery over £60 within a 3 mile radius • UK Standard £4.99</p>
    </div>

    <!-- Header / Navigation -->
    <header class="sticky top-0 z-50 bg-sb-black/95 backdrop-blur-md transition-all duration-300 border-b border-white/5" id="main-header">
        <div class="container mx-auto px-6 lg:px-12">
            <div class="grid grid-cols-[1fr_auto_1fr] items-center h-20 md:h-24">
                
                <!-- Left Nav -->
                <div class="flex items-center justify-start lg:justify-end h-full">
                    <button id="mobile-menu-btn" class="lg:hidden text-xl text-sb-cream focus:outline-none hover:text-sb-gold transition-colors mr-auto p-2">
                        <i class="fas fa-bars"></i>
                    </button>
                    <nav class="hidden lg:flex space-x-8 xl:space-x-10 text-[11px] font-medium tracking-luxury text-gray-300 uppercase items-center">
                        <a href="#home" class="hover:text-sb-gold transition-colors duration-300">Home</a>
                        
                        <!-- FIXED MENU (Hardcoded) -->
                        <div class="relative group h-full flex items-center">
                            <button class="hover:text-sb-gold transition-colors duration-300 focus:outline-none py-4 uppercase tracking-luxury flex items-center gap-1">
                                Shop Collections <i class="fas fa-chevron-down text-[8px] opacity-50 ml-1"></i>
                            </button>
                            <div class="nav-dropdown absolute top-full left-0 w-48 bg-sb-black border border-white/10 shadow-2xl pt-2 pb-2">
                                <a href="#collection-seasonal" class="block px-6 py-3 hover:bg-white/5 hover:text-sb-gold text-[10px] tracking-luxury transition-colors uppercase">Seasonal</a>
                                <a href="#collection-luxury" class="block px-6 py-3 hover:bg-white/5 hover:text-sb-gold text-[10px] tracking-luxury transition-colors uppercase">Luxury</a>
                                <a href="#collection-gothic" class="block px-6 py-3 hover:bg-white/5 hover:text-sb-gold text-[10px] tracking-luxury transition-colors uppercase">Gothic</a>
                                <a href="#collection-fairytale" class="block px-6 py-3 hover:bg-white/5 hover:text-sb-gold text-[10px] tracking-luxury transition-colors uppercase">Fairy Tale</a>
                            </div>
                        </div>
                    </nav>
                </div>

                <!-- Center Logo -->
                <div class="flex justify-center h-full items-center px-8">
                    <a href="#home" class="group block text-center">
                        <img src="images/logo.png" alt="SB Floristry" class="h-16 w-auto object-contain opacity-90 group-hover:opacity-100 transition-opacity">
                    </a>
                </div>

                <!-- Right Nav -->
                <div class="flex items-center justify-end lg:justify-between h-full w-full">
                    <nav class="hidden lg:flex space-x-8 xl:space-x-10 text-[11px] font-medium tracking-luxury text-gray-300 uppercase items-center">
                        <a href="#subscriptions" class="hover:text-sb-gold transition-colors duration-300">Subscriptions</a>
                        <div class="relative group h-full flex items-center">
                            <button class="hover:text-sb-gold transition-colors duration-300 focus:outline-none py-4 uppercase tracking-luxury flex items-center gap-1">
                                Events <i class="fas fa-chevron-down text-[8px] opacity-50 ml-1"></i>
                            </button>
                            <div class="nav-dropdown absolute top-full right-0 w-56 bg-sb-black border border-white/10 shadow-2xl pt-2 pb-2">
                                <a href="#weddings" class="block px-6 py-3 hover:bg-white/5 hover:text-sb-gold text-[10px] tracking-luxury transition-colors">Weddings</a>
                                <a href="#funerals" class="block px-6 py-3 hover:bg-white/5 hover:text-sb-gold text-[10px] tracking-luxury transition-colors">Funerals</a>
                                <a href="#babyshowers" class="block px-6 py-3 hover:bg-white/5 hover:text-sb-gold text-[10px] tracking-luxury transition-colors">Baby Showers</a>
                                <a href="#workevents" class="block px-6 py-3 hover:bg-white/5 hover:text-sb-gold text-[10px] tracking-luxury transition-colors">Corporate</a>
                            </div>
                        </div>
                        <a href="#contact" class="hover:text-sb-gold transition-colors duration-300">Contact</a>
                    </nav>

                    <div class="flex items-center space-x-6 text-sb-cream/80">
                        <button id="cart-icon-btn" class="relative hover:text-sb-gold transition-colors group p-1">
                            <i class="fas fa-shopping-bag text-sm"></i>
                            <span id="cart-count" class="absolute -top-2 -right-2 text-sb-gold font-bold font-serif text-xs w-5 h-5 flex items-center justify-center opacity-0 transition-opacity duration-300 bg-sb-black rounded-full border border-sb-gold">0</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Mobile Menu -->
    <div id="mobile-menu" class="fixed inset-0 bg-sb-black z-[100] transform -translate-x-full transition-transform duration-500 ease-in-out lg:hidden flex flex-col pt-20 px-8 overflow-y-auto">
        <button id="close-menu-btn" class="absolute top-6 right-6 text-2xl text-sb-cream hover:text-sb-gold transition-colors p-2">
            <i class="fas fa-times"></i>
        </button>
        <nav class="flex flex-col space-y-4 text-lg font-serif text-sb-cream text-center mt-6 font-light">
            <a href="#home" class="border-b border-white/5 pb-3 hover:text-sb-gold transition-colors block">Home</a>
            <div>
                <button class="mobile-accordion-btn w-full flex justify-between items-center text-sb-gold text-sm tracking-widest uppercase py-3 border-b border-white/5 focus:outline-none">
                    Shop Collections <i class="fas fa-chevron-down text-xs transition-transform duration-300"></i>
                </button>
                <div class="mobile-accordion-content bg-white/5">
                     <a href="#collection-seasonal" class="block py-3 text-base text-gray-300 hover:text-white">Seasonal</a>
                     <a href="#collection-luxury" class="block py-3 text-base text-gray-300 hover:text-white">Luxury</a>
                     <a href="#collection-gothic" class="block py-3 text-base text-gray-300 hover:text-white">Gothic</a>
                     <a href="#collection-fairytale" class="block py-3 text-base text-gray-300 hover:text-white">Fairy Tale</a>
                </div>
            </div>
            <a href="#subscriptions" class="border-b border-white/5 pb-3 hover:text-sb-gold transition-colors block">Subscriptions</a>
            <div>
                <button class="mobile-accordion-btn w-full flex justify-between items-center text-sb-gold text-sm tracking-widest uppercase py-3 border-b border-white/5 focus:outline-none">
                    Events <i class="fas fa-chevron-down text-xs transition-transform duration-300"></i>
                </button>
                <div class="mobile-accordion-content bg-white/5">
                    <a href="#weddings" class="block py-3 text-base text-gray-300 hover:text-white">Weddings</a>
                    <a href="#funerals" class="block py-3 text-base text-gray-300 hover:text-white">Funerals</a>
                    <a href="#babyshowers" class="block py-3 text-base text-gray-300 hover:text-white">Baby Showers</a>
                    <a href="#genderreveal" class="block py-3 text-base text-gray-300 hover:text-white">Gender Reveal</a>
                    <a href="#workevents" class="block py-3 text-base text-gray-300 hover:text-white">Corporate</a>
                </div>
            </div>
             <a href="#contact" class="border-b border-white/5 pb-3 hover:text-sb-gold transition-colors block">Contact</a>
        </nav>
    </div>

    <!-- SIDE CART -->
    <div id="side-cart-overlay" class="fixed inset-0 cart-overlay z-[150] hidden opacity-0 transition-opacity duration-300"></div>
    <div id="side-cart" class="fixed top-0 right-0 h-full w-full max-w-[400px] bg-white z-[160] transform translate-x-full transition-transform duration-500 shadow-2xl flex flex-col">
        <div class="shrink-0 p-6 border-b border-gray-100 flex justify-between items-center bg-sb-black text-sb-cream">
            <h2 class="font-serif text-2xl tracking-wide font-light">Your Selection</h2>
            <button id="close-cart-btn" class="text-sb-gold hover:text-white transition-colors text-2xl"><i class="fas fa-times"></i></button>
        </div>
        <div class="shrink-0 px-6 py-4 bg-gray-50 border-b border-gray-100">
             <div id="shipping-info">
                 <p id="shipping-message" class="text-xs font-bold text-center text-sb-black mb-2">Spend <span class="text-sb-gold">£60.00</span> more for Free Delivery</p>
                 <div class="w-full bg-gray-200 h-1.5 rounded-full overflow-hidden"><div id="shipping-bar" class="bg-sb-gold h-full rounded-full transition-all duration-500" style="width: 0%"></div></div>
            </div>
        </div>
        <div class="flex-1 overflow-y-auto cart-scroll bg-white">
            <div id="cart-items-container" class="p-6 pb-2">
                <p class="text-sm tracking-luxury uppercase text-gray-400 text-center mt-10">Your cart is empty</p>
            </div>
            <div id="cart-extras" class="px-6 py-6 bg-sb-cream border-t border-gray-100 hidden">
                <div class="mb-6">
                    <label for="cart-note" class="block text-xs font-bold tracking-luxury uppercase text-gray-400 mb-2">Gift Message</label>
                    <textarea id="cart-note" rows="3" class="w-full bg-white border border-gray-200 p-3 text-base text-sb-black placeholder-gray-300 focus:border-sb-gold outline-none resize-none" placeholder="Card message..."></textarea>
                </div>
                
                <!-- CUSTOM BRANDED DATE PICKER -->
                <div class="mb-4 relative">
                    <label for="delivery-date-display" class="block text-xs font-bold tracking-luxury uppercase text-gray-400 mb-2">Requested Delivery Date</label>
                    <div class="relative">
                        <input type="text" id="delivery-date-display" readonly placeholder="Select a delivery date..." 
                               class="w-full bg-white border border-gray-200 p-3 text-base text-sb-black focus:border-sb-gold outline-none cursor-pointer">
                        <input type="hidden" id="delivery-date" name="delivery-date">
                        <i class="fas fa-calendar-alt absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 pointer-events-none"></i>
                    </div>
                    <!-- Custom Calendar UI -->
                    <div id="custom-datepicker" class="hidden absolute bottom-full left-0 w-full bg-white border border-gray-200 shadow-2xl z-50 mb-2 rounded-sm">
                        <div class="flex justify-between items-center bg-sb-black p-3">
                            <button id="prev-month" class="text-sb-gold hover:text-white px-2"><i class="fas fa-chevron-left"></i></button>
                            <span id="current-month-year" class="text-sb-cream font-serif tracking-widest text-sm uppercase"></span>
                            <button id="next-month" class="text-sb-gold hover:text-white px-2"><i class="fas fa-chevron-right"></i></button>
                        </div>
                        <div class="grid grid-cols-7 text-center p-2 bg-gray-50 border-b border-gray-100">
                            <span class="text-[10px] text-gray-400 uppercase font-bold">Su</span>
                            <span class="text-[10px] text-gray-400 uppercase font-bold">Mo</span>
                            <span class="text-[10px] text-gray-400 uppercase font-bold">Tu</span>
                            <span class="text-[10px] text-gray-400 uppercase font-bold">We</span>
                            <span class="text-[10px] text-gray-400 uppercase font-bold">Th</span>
                            <span class="text-[10px] text-gray-400 uppercase font-bold">Fr</span>
                            <span class="text-[10px] text-gray-400 uppercase font-bold">Sa</span>
                        </div>
                        <div id="calendar-days" class="grid grid-cols-7 text-center p-2 gap-1 text-sm text-sb-black">
                            <!-- Days injected via JS -->
                        </div>
                    </div>
                    <p id="date-error" class="text-xs text-red-500 mt-1 hidden"></p>
                </div>
            </div>
        </div>
        <div class="shrink-0 p-6 border-t border-gray-100 bg-white">
            <div class="flex justify-between items-end mb-6">
                <span class="text-xs font-bold tracking-luxury uppercase text-gray-400">Total</span>
                <span id="cart-subtotal" class="font-serif text-2xl text-sb-black">£0.00</span>
            </div>
            <button id="checkout-btn" class="w-full btn-luxury bg-sb-black text-sb-cream py-4 uppercase tracking-luxury text-xs font-bold border border-sb-black">Proceed to Checkout</button>
        </div>
    </div>

    <!-- QUICK VIEW MODAL -->
    <div id="quick-view-modal" class="fixed inset-0 z-[200] hidden overflow-y-auto">
        <div class="flex min-h-screen items-center justify-center p-4">
            <div class="fixed inset-0 bg-black/80 backdrop-blur-sm transition-opacity" onclick="closeQuickView()"></div>
            <div class="relative w-full max-w-4xl bg-white shadow-2xl overflow-hidden animate-fade-in-up flex flex-col md:flex-row">
                <button onclick="closeQuickView()" class="absolute top-4 right-4 text-gray-400 hover:text-sb-black z-10 p-2"><i class="fas fa-times text-2xl"></i></button>
                <div class="w-full md:w-1/2 h-64 md:h-auto bg-gray-100 relative"><img id="qv-image" src="" alt="" class="w-full h-full object-cover"></div>
                <div class="w-full md:w-1/2 p-8 md:p-12 flex flex-col justify-center bg-sb-cream">
                    <h3 id="qv-title" class="font-serif text-4xl md:text-5xl text-sb-black mb-2 font-normal"></h3>
                    <p id="qv-price" class="text-2xl text-sb-gold font-bold mb-6"></p>
                    <div class="w-12 h-px bg-gray-300 mb-6"></div>
                    <p id="qv-description" class="text-gray-600 font-light text-lg leading-relaxed mb-8"></p>
                    <button id="qv-add-btn" class="w-full btn-luxury bg-sb-black text-white py-4 uppercase tracking-luxury text-xs font-bold" onclick="addToCart(this, this.getAttribute('data-shopify-id'))">Add to Cart</button>
                </div>
            </div>
        </div>
    </div>

    <!-- MAIN CONTENT -->
    <main id="app-content" class="flex-grow min-h-screen">
        
        <!-- 1. VIEW: HOME -->
        <div id="view-home" class="view-section active-view">
            <section class="relative h-[90vh] overflow-hidden">
                <div class="absolute inset-0">
                    <img src="images/hero.jpg" alt="Luxury Bouquet" class="w-full h-full object-cover hero-zoom opacity-90" style="object-position: center 60%;">
                    <div class="absolute inset-0 bg-gradient-to-t from-black/80 via-black/20 to-black/30"></div>
                </div>
                <div class="relative z-10 container mx-auto px-6 h-full flex flex-col justify-center items-center text-center text-sb-cream pt-20">
                    <h2 class="text-xs md:text-sm tracking-[0.3em] uppercase mb-8 font-medium text-sb-gold animate-fade-in">Hand-Tied in Essex • Delivered to London</h2>
                    <h1 class="font-serif text-6xl md:text-8xl lg:text-9xl mb-10 leading-none animate-fade-in-up font-normal">
                        Artistry in <br/><span class="italic font-light text-gold-metallic">Every Bloom</span>
                    </h1>
                </div>
            </section>
            
            <section class="py-24 bg-sb-black text-sb-cream relative border-t border-white/5">
                <div class="container mx-auto px-6 text-center max-w-2xl">
                    <span class="text-gold-metallic text-2xl mb-6 block reveal"><i class="fas fa-leaf"></i></span>
                    <h2 class="font-serif text-4xl md:text-5xl text-sb-cream mb-8 reveal font-light">A Family Affair</h2>
                    <p class="text-gray-400 leading-relaxed text-xl font-light mb-12 reveal">
                        Welcome to SB Floristry. We are a mother and daughter team bringing bespoke, luxury floral design to weddings, events, and homes across Essex and London. Every arrangement is hand-selected and styled with the care only family can provide.
                    </p>
                    <div class="flex flex-col md:flex-row justify-center gap-12 text-xs font-bold tracking-luxury text-sb-cream uppercase reveal">
                        <div class="flex items-center justify-center"><i class="fas fa-truck mr-3 text-sb-gold"></i> Free Local Delivery</div>
                        <div class="flex items-center justify-center"><i class="fas fa-heart mr-3 text-sb-gold"></i> Family Owned</div>
                    </div>
                </div>
            </section>
            
            <section class="py-24 bg-sb-cream">
                <div class="container mx-auto px-6">
                    <div class="text-center mb-16 reveal">
                        <h3 class="font-serif text-5xl text-sb-black mb-4 font-light">Explore Our Collections</h3>
                        <div class="w-16 h-px bg-sb-gold mx-auto mt-6"></div>
                    </div>
                    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6">
                        <a href="#collection-seasonal" class="group relative block h-[500px] overflow-hidden cursor-pointer reveal" data-handle="seasonal">
                            <img src="images/prod-winter.jpg" alt="Seasonal Collection" class="w-full h-full object-cover transition-transform duration-[1.5s] group-hover:scale-105 loaded" style="opacity:1;">
                            <div class="absolute inset-0 bg-black/20 group-hover:bg-black/30 transition-colors duration-500"></div>
                            <div class="absolute inset-0 flex flex-col items-center justify-center text-center p-4">
                                <h4 class="font-serif text-4xl text-sb-cream mb-2 translate-y-4 group-hover:translate-y-0 transition-transform duration-500 font-light">Seasonal</h4>
                                <span class="text-sb-cream text-xs tracking-luxury uppercase border-b border-transparent group-hover:border-sb-cream pb-1 opacity-0 group-hover:opacity-100 transition-all duration-500 delay-100">View Collection</span>
                            </div>
                        </a>
                        <a href="#collection-luxury" class="group relative block h-[500px] overflow-hidden cursor-pointer reveal delay-75" data-handle="luxury">
                            <img src="images/prod-ivory.jpg" alt="Luxury Collection" class="w-full h-full object-cover transition-transform duration-[1.5s] group-hover:scale-105 loaded" style="opacity:1;">
                            <div class="absolute inset-0 bg-black/20 group-hover:bg-black/30 transition-colors duration-500"></div>
                            <div class="absolute inset-0 flex flex-col items-center justify-center text-center p-4">
                                <h4 class="font-serif text-4xl text-sb-cream mb-2 translate-y-4 group-hover:translate-y-0 transition-transform duration-500 font-light">Luxury</h4>
                                <span class="text-sb-cream text-xs tracking-luxury uppercase border-b border-transparent group-hover:border-sb-cream pb-1 opacity-0 group-hover:opacity-100 transition-all duration-500 delay-100">View Collection</span>
                            </div>
                        </a>
                        <a href="#collection-gothic" class="group relative block h-[500px] overflow-hidden cursor-pointer reveal delay-100" data-handle="gothic">
                            <img src="images/prod-velvet-darkness.jpg" alt="Gothic Collection" class="w-full h-full object-cover transition-transform duration-[1.5s] group-hover:scale-105 loaded" style="opacity:1;">
                            <div class="absolute inset-0 bg-black/40 group-hover:bg-black/50 transition-colors duration-500"></div>
                            <div class="absolute inset-0 flex flex-col items-center justify-center text-center p-4">
                                <h4 class="font-serif text-4xl text-sb-cream mb-2 translate-y-4 group-hover:translate-y-0 transition-transform duration-500 font-light">Gothic</h4>
                                <span class="text-sb-cream text-xs tracking-luxury uppercase border-b border-transparent group-hover:border-sb-cream pb-1 opacity-0 group-hover:opacity-100 transition-all duration-500 delay-100">View Collection</span>
                            </div>
                        </a>
                        <a href="#collection-fairytale" class="group relative block h-[500px] overflow-hidden cursor-pointer reveal delay-125" data-handle="fairytale">
                            <img src="images/prod-bibbidi.jpg" alt="Fairy Tale Collection" class="w-full h-full object-cover transition-transform duration-[1.5s] group-hover:scale-105 loaded" style="opacity:1;">
                            <div class="absolute inset-0 bg-black/20 group-hover:bg-black/30 transition-colors duration-500"></div>
                            <div class="absolute inset-0 flex flex-col items-center justify-center text-center p-4">
                                <h4 class="font-serif text-4xl text-sb-cream mb-2 translate-y-4 group-hover:translate-y-0 transition-transform duration-500 font-light">Fairy Tale</h4>
                                <span class="text-sb-cream text-xs tracking-luxury uppercase border-b border-transparent group-hover:border-sb-cream pb-1 opacity-0 group-hover:opacity-100 transition-all duration-500 delay-100">View Collection</span>
                            </div>
                        </a>
                    </div>
                </div>
            </section>

            <!-- SUBSCRIPTION PROMO -->
            <section class="py-24 bg-white">
                <div class="container mx-auto px-6">
                    <div class="flex flex-col lg:flex-row items-center gap-12 lg:gap-20">
                        <div class="w-full lg:w-1/2 h-[600px] reveal relative group overflow-hidden">
                             <img src="images/prod-subscription.jpg" alt="Subscriptions" class="w-full h-full object-cover transition-transform duration-[1.5s] group-hover:scale-105 loaded" style="opacity:1">
                             <div class="absolute inset-0 bg-black/10 group-hover:bg-black/0 transition-colors duration-500"></div>
                        </div>
                        <div class="w-full lg:w-1/2 text-center lg:text-left reveal delay-100">
                            <span class="text-sb-gold text-xs tracking-super-wide uppercase font-bold mb-4 block">Effortless Beauty</span>
                            <h2 class="font-serif text-4xl md:text-6xl text-sb-black mb-6 font-light">The Flower Subscription</h2>
                            <div class="w-16 h-px bg-sb-gold mx-auto lg:mx-0 mb-8"></div>
                            <p class="text-gray-600 font-light leading-relaxed mb-8 text-lg">
                                Enjoy the luxury of fresh, seasonal stems delivered directly to your door. Choose from weekly, bi-weekly, or monthly plans designed to bring life and fragrance to your home.
                            </p>
                            <div class="flex flex-col sm:flex-row gap-4 justify-center lg:justify-start">
                                <a href="#subscriptions" class="btn-luxury border border-sb-black text-sb-black px-12 py-4 uppercase tracking-luxury text-xs font-bold inline-block hover:bg-sb-black hover:text-white transition-all">
                                    View Plans
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </div>

        <!-- 2. VIEW: DYNAMIC COLLECTION -->
        <div id="view-dynamic-collection" class="view-section">
            <section class="pt-40 pb-20 bg-sb-cream text-center" id="dynamic-hero">
                <span class="text-sb-gold text-xs tracking-super-wide uppercase font-bold mb-4 block">The Collection</span>
                <h1 class="font-serif text-6xl md:text-8xl mb-6 font-light text-sb-black" id="dynamic-title">Loading...</h1>
                <p class="text-xl font-light italic text-gray-500 max-w-2xl mx-auto" id="dynamic-desc"></p>
            </section>
            <section class="pb-24 bg-sb-cream" id="dynamic-bg">
                 <div class="container mx-auto px-6">
                    <div id="dynamic-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-12">
                        <div class="col-span-full text-center py-12">
                             <div class="loader"></div>
                             <p class="text-gray-400 text-sm tracking-luxury uppercase">Fetching Blooms...</p>
                        </div>
                    </div>
                 </div>
            </section>
        </div>

        <!-- 3. VIEW: STATIC EVENTS -->
        <div id="view-weddings" class="view-section">
            <section class="relative h-[60vh] overflow-hidden">
                <div class="absolute inset-0">
                    <img src="images/weddings-bg.jpg" alt="Weddings Banner" class="w-full h-full object-cover">
                    <div class="absolute inset-0 bg-black/50"></div>
                </div>
                <div class="relative z-10 container mx-auto px-6 h-full flex flex-col justify-center items-center text-center text-sb-cream">
                    <h1 class="font-serif text-6xl md:text-8xl mb-6 font-light">Weddings</h1>
                </div>
            </section>
            <section class="py-24 bg-sb-cream">
                <div class="container mx-auto px-6 max-w-4xl text-center">
                    <h2 class="font-serif text-4xl text-sb-black mb-8 font-light italic">Your Love Story, In Bloom</h2>
                    <p class="text-xl text-gray-600 font-light leading-relaxed mb-12">
                        From charming Essex countryside weddings to glamorous London ballroom celebrations, we design with heart and precision. We believe your wedding flowers should be as unique as your relationship, setting the tone for a day you will never forget.
                    </p>
                    
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-12 mt-16 mb-16 text-left">
                        <div class="text-center">
                            <div class="h-64 overflow-hidden mb-6">
                                <img src="images/wedding-bridal.jpg" alt="Bridal Party" class="w-full h-full object-cover hover:scale-105 transition-transform duration-700 loaded" style="opacity:1">
                            </div>
                            <h3 class="font-serif text-2xl text-sb-black mb-2">Bridal Party</h3>
                            <p class="text-sm text-gray-500 leading-relaxed">Exquisite bouquets and buttonholes tailored to your palette.</p>
                        </div>
                        <div class="text-center">
                            <div class="h-64 overflow-hidden mb-6">
                                <img src="images/wedding-ceremony.jpg" alt="Ceremony" class="w-full h-full object-cover hover:scale-105 transition-transform duration-700 loaded" style="opacity:1">
                            </div>
                            <h3 class="font-serif text-2xl text-sb-black mb-2">Ceremony</h3>
                            <p class="text-sm text-gray-500 leading-relaxed">Aisle markers, archways, and pew ends that create a magical setting.</p>
                        </div>
                        <div class="text-center">
                            <div class="h-64 overflow-hidden mb-6">
                                <img src="images/wedding-reception.jpg" alt="Reception" class="w-full h-full object-cover hover:scale-105 transition-transform duration-700 loaded" style="opacity:1">
                            </div>
                            <h3 class="font-serif text-2xl text-sb-black mb-2">Reception</h3>
                            <p class="text-sm text-gray-500 leading-relaxed">Breathtaking centrepieces and installations for the perfect celebration.</p>
                        </div>
                    </div>

                    <a href="#contact" class="btn-luxury border border-sb-black text-sb-black px-10 py-3 uppercase tracking-luxury text-xs font-bold inline-block">Book Consultation</a>
                </div>
            </section>
        </div>
        
        <div id="view-funerals" class="view-section">
            <section class="pt-40 pb-20 bg-sb-cream text-center">
                <span class="text-sb-gold text-xs tracking-super-wide uppercase font-bold mb-4 block">Sympathy & Remembrance</span>
                <h1 class="font-serif text-5xl md:text-7xl mb-6 font-light text-sb-black">Farewell with Grace</h1>
            </section>
            <section class="pb-24 bg-sb-cream">
                <div class="container mx-auto px-6 max-w-4xl">
                     <div class="text-center mb-16">
                        <p class="text-xl text-gray-600 font-light leading-relaxed">
                            We understand the importance of saying goodbye beautifully. Sympathy arrangements created with care using seasonal blooms. Let us help you express your condolences when words are not enough.
                        </p>
                     </div>
                     <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-16">
                         <div class="bg-white p-8 shadow-sm hover:shadow-md transition-shadow">
                             <h3 class="font-serif text-2xl text-sb-black mb-4">Casket Sprays</h3>
                             <p class="text-gray-500 font-light mb-4">Elegant, double-ended sprays that sit perfectly atop the casket. Available in various sizes and color palettes.</p>
                             <span class="text-sb-gold text-xs tracking-widest uppercase font-bold">From £150</span>
                         </div>
                         <div class="bg-white p-8 shadow-sm hover:shadow-md transition-shadow">
                             <h3 class="font-serif text-2xl text-sb-black mb-4">Wreaths & Hearts</h3>
                             <p class="text-gray-500 font-light mb-4">Traditional circular wreaths or heart-shaped tributes symbolizing eternal love. Hand-made with fresh moss bases.</p>
                             <span class="text-sb-gold text-xs tracking-widest uppercase font-bold">From £65</span>
                         </div>
                         <div class="bg-white p-8 shadow-sm hover:shadow-md transition-shadow">
                             <h3 class="font-serif text-2xl text-sb-black mb-4">Posies & Baskets</h3>
                             <p class="text-gray-500 font-light mb-4">Smaller, thoughtful arrangements perfect for family members to contribute or for grave-side placement.</p>
                             <span class="text-sb-gold text-xs tracking-widest uppercase font-bold">From £45</span>
                         </div>
                         <div class="bg-white p-8 shadow-sm hover:shadow-md transition-shadow">
                             <h3 class="font-serif text-2xl text-sb-black mb-4">Bespoke Tributes</h3>
                             <p class="text-gray-500 font-light mb-4">Letters (MUM, DAD), religious symbols, or custom shapes that reflect the personality and hobbies of the departed.</p>
                             <span class="text-sb-gold text-xs tracking-widest uppercase font-bold">POA</span>
                         </div>
                     </div>
                    <div class="text-center">
                         <a href="#contact" class="btn-luxury border border-sb-black text-sb-black px-10 py-3 uppercase tracking-luxury text-xs font-bold inline-block">Contact Us</a>
                    </div>
                </div>
            </section>
        </div>
        
        <div id="view-babyshowers" class="view-section">
            <section class="pt-40 pb-20 bg-sb-cream text-center">
                <h1 class="font-serif text-6xl md:text-8xl mb-6 font-light text-sb-black">Baby Showers</h1>
            </section>
            <section class="pb-24 bg-sb-cream">
                <div class="container mx-auto px-6 max-w-5xl">
                    <div class="text-center mb-16">
                        <p class="text-xl text-gray-600 font-light leading-relaxed max-w-3xl mx-auto">
                            From flower arches to delicate table centres, we create the perfect backdrop for celebrating the upcoming arrival. Whether you desire soft pastels, neutral creams, or vibrant themes, we bring the vision to life.
                        </p>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-12 items-center">
                        <div class="h-[500px] overflow-hidden">
                             <img src="images/babyshower-arch.jpg" alt="Baby Shower Arch" class="w-full h-full object-cover loaded" style="opacity:1">
                        </div>
                        <div class="space-y-8">
                            <div>
                                <h3 class="font-serif text-3xl text-sb-black mb-3">"Oh Baby" Backdrops</h3>
                                <p class="text-gray-500 font-light">The ultimate photo opportunity. We combine lush foliage, fresh blooms, and optional neon signage or balloons to create a focal point for your event.</p>
                            </div>
                            <div>
                                <h3 class="font-serif text-3xl text-sb-black mb-3">Table Scapes</h3>
                                <p class="text-gray-500 font-light">Bud vases running down long tables or grand centrepieces for round tables. We style the flowers to complement your favors and cake.</p>
                            </div>
                            <div>
                                <h3 class="font-serif text-3xl text-sb-black mb-3">Flower Crowns</h3>
                                <p class="text-gray-500 font-light">Make the mum-to-be feel extra special with a bespoke fresh flower crown, or host a crown-making workshop as an activity!</p>
                            </div>
                            <a href="#contact" class="btn-luxury border border-sb-black text-sb-black px-10 py-3 uppercase tracking-luxury text-xs font-bold inline-block mt-4">Enquire Now</a>
                        </div>
                    </div>
                </div>
            </section>
        </div>
        
        <div id="view-genderreveal" class="view-section">
             <section class="pt-40 pb-20 bg-sb-cream text-center">
                <h1 class="font-serif text-6xl md:text-8xl mb-6 font-light text-sb-black">Gender Reveal</h1>
                <p class="text-xl text-gray-600 font-light max-w-2xl mx-auto mb-8">Pink or Blue? Build the anticipation with our stunning reveal boxes and floral arrangements.</p>
                <a href="#contact" class="btn-luxury border border-sb-black text-sb-black px-10 py-3 uppercase tracking-luxury text-xs font-bold inline-block mt-8">Enquire Now</a>
            </section>
        </div>
        
        <div id="view-workevents" class="view-section">
             <section class="pt-40 pb-20 bg-sb-black text-center text-sb-cream">
                <span class="text-sb-gold text-xs tracking-super-wide uppercase font-bold mb-4 block">Corporate Services</span>
                <h1 class="font-serif text-5xl md:text-7xl mb-6 font-light">Hotels, Spas & Events</h1>
            </section>
            <section class="pb-24 bg-sb-black text-sb-cream">
                <div class="container mx-auto px-6 max-w-5xl">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-16">
                        <div>
                             <h3 class="font-serif text-3xl text-sb-gold mb-6">Hotels & Lobbies</h3>
                             <p class="text-gray-400 font-light leading-relaxed mb-6">
                                 First impressions matter. We provide weekly contract flowers for hotel lobbies, receptions, and restaurants across London and Essex. Our designs are architectural, long-lasting, and tailored to your brand's interior aesthetic.
                             </p>
                             <ul class="text-sm tracking-widest uppercase space-y-3 text-gray-500">
                                 <li><i class="fas fa-check text-sb-gold mr-2"></i> Weekly Installation & Maintenance</li>
                                 <li><i class="fas fa-check text-sb-gold mr-2"></i> Vase Hire Included</li>
                                 <li><i class="fas fa-check text-sb-gold mr-2"></i> Dedicated Account Manager</li>
                             </ul>
                        </div>
                        <div>
                             <h3 class="font-serif text-3xl text-sb-gold mb-6">Luxury Spas</h3>
                             <p class="text-gray-400 font-light leading-relaxed mb-6">
                                 Enhance the serenity of your spa environment with biophilic design. We create calming arrangements using eucalyptus, orchids, and tropical foliage that thrive in humid environments and promote relaxation.
                             </p>
                             <ul class="text-sm tracking-widest uppercase space-y-3 text-gray-500">
                                 <li><i class="fas fa-check text-sb-gold mr-2"></i> Long-lasting tropicals</li>
                                 <li><i class="fas fa-check text-sb-gold mr-2"></i> Aromatherapy-complementary blooms</li>
                             </ul>
                        </div>
                    </div>
                    
                    <div class="mt-20 border-t border-white/10 pt-16 text-center">
                        <h3 class="font-serif text-3xl text-white mb-6">Client Gifting & Events</h3>
                        <p class="text-gray-400 font-light max-w-2xl mx-auto mb-10">From product launches to employee appreciation bouquets, we handle all your corporate floral needs.</p>
                        <a href="#contact" class="btn-luxury border border-sb-cream text-sb-cream px-10 py-3 uppercase tracking-luxury text-xs font-bold inline-block">Request a Proposal</a>
                    </div>
                </div>
            </section>
        </div>

        <!-- 4. VIEW: SUBSCRIPTIONS -->
        <div id="view-subscriptions" class="view-section">
            <section class="relative h-[60vh] overflow-hidden">
                <div class="absolute inset-0">
                    <!-- Updated Image ID for Random Fetch -->
                    <img id="subscription-hero-image" src="images/prod-subscription.jpg" alt="Flower Subscription" class="w-full h-full object-cover">
                    <div class="absolute inset-0 bg-black/40"></div>
                </div>
                <div class="relative z-10 container mx-auto px-6 h-full flex flex-col justify-center items-center text-center text-sb-cream">
                    <span class="text-sb-gold text-xs tracking-super-wide uppercase font-bold mb-4 animate-fade-in">Join the Club</span>
                    <h1 class="font-serif text-6xl md:text-8xl mb-6 font-light animate-fade-in-up">Flower Subscriptions</h1>
                    <p class="text-lg font-light tracking-wide max-w-xl mx-auto animate-fade-in">Fresh blooms delivered to your door, on your schedule.</p>
                </div>
            </section>
            
            <section class="py-24 bg-sb-cream">
                <div class="container mx-auto px-6">
                    <div class="text-center mb-16">
                        <h2 class="font-serif text-4xl text-sb-black mb-4">Choose Your Plan</h2>
                        <div class="w-16 h-px bg-sb-gold mx-auto mt-6"></div>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-8 max-w-6xl mx-auto">
                        <!-- Plan 1 -->
                        <div class="bg-white p-8 border border-gray-100 flex flex-col items-center text-center hover:shadow-xl transition-shadow duration-300 group" data-title="The Seasonal Subscription" data-price="£45.00" data-image="images/prod-subscription.jpg" data-handle="seasonal-subscription">
                            <h3 class="font-serif text-2xl text-sb-black mb-2">The Seasonal</h3>
                            <p class="text-xs tracking-widest text-gray-400 uppercase mb-6">Monthly Joy</p>
                            <div class="text-4xl font-serif text-sb-gold mb-6">£45<span class="text-sm text-gray-400 font-sans">/mo</span></div>
                            <ul class="text-sm text-gray-500 space-y-4 mb-8 flex-grow">
                                <li>Seasonal hand-tied bouquet</li>
                                <li>Delivered once a month</li>
                                <li>Cancel anytime</li>
                            </ul>
                            <button onclick="addToCart(this)" class="w-full btn-luxury bg-sb-black text-sb-cream py-3 uppercase tracking-luxury text-xs font-bold">Subscribe</button>
                        </div>
                        
                        <!-- Plan 2 -->
                        <div class="bg-sb-black text-sb-cream p-8 border border-sb-gold transform scale-105 shadow-2xl flex flex-col items-center text-center relative group" data-title="The Luxury Subscription" data-price="£85.00" data-image="images/prod-subscription.jpg" data-handle="luxury-subscription">
                            <span class="absolute top-0 left-1/2 transform -translate-x-1/2 -translate-y-1/2 bg-sb-gold text-sb-black text-[10px] uppercase font-bold px-3 py-1 tracking-widest">Most Popular</span>
                            <h3 class="font-serif text-2xl mb-2">The Luxury</h3>
                            <p class="text-xs tracking-widest text-gray-400 uppercase mb-6">Bi-Weekly Indulgence</p>
                            <div class="text-4xl font-serif text-sb-gold mb-6">£85<span class="text-sm text-gray-400 font-sans">/mo</span></div>
                            <ul class="text-sm text-gray-300 space-y-4 mb-8 flex-grow">
                                <li>Premium stems & larger arrangement</li>
                                <li>Delivered every 2 weeks</li>
                                <li>Luxury Vase included</li>
                            </ul>
                            <button onclick="addToCart(this)" class="w-full btn-luxury bg-sb-gold text-sb-black border-sb-gold py-3 uppercase tracking-luxury text-xs font-bold">Subscribe</button>
                        </div>
                        
                        <!-- Plan 3 -->
                        <div class="bg-white p-8 border border-gray-100 flex flex-col items-center text-center hover:shadow-xl transition-shadow duration-300 group" data-title="The Weekly Subscription" data-price="£150.00" data-image="images/prod-subscription.jpg" data-handle="weekly-subscription">
                            <h3 class="font-serif text-2xl text-sb-black mb-2">The Weekly</h3>
                            <p class="text-xs tracking-widest text-gray-400 uppercase mb-6">Ultimate Freshness</p>
                            <div class="text-4xl font-serif text-sb-gold mb-6">£150<span class="text-sm text-gray-400 font-sans">/mo</span></div>
                            <ul class="text-sm text-gray-500 space-y-4 mb-8 flex-grow">
                                <li>Fresh flowers every week</li>
                                <li>Rotates between styles</li>
                                <li>Perfect for home styling</li>
                            </ul>
                            <button onclick="addToCart(this)" class="w-full btn-luxury bg-sb-black text-sb-cream py-3 uppercase tracking-luxury text-xs font-bold">Subscribe</button>
                        </div>
                    </div>
                </div>
            </section>
        </div>

        <!-- 5. VIEW: CONTACT -->
        <div id="view-contact" class="view-section">
            <section class="pt-40 pb-20 bg-sb-black text-center text-sb-cream">
                <span class="text-sb-gold text-xs tracking-super-wide uppercase font-bold mb-4 block">Get in Touch</span>
                <h1 class="font-serif text-5xl md:text-7xl mb-12 font-light">Contact Us</h1>
                
                <div class="flex flex-col md:flex-row justify-center gap-12 mb-16 text-lg font-light tracking-wide">
                    <div>
                        <i class="fas fa-phone text-sb-gold mb-4 text-2xl block"></i>
                        <p class="text-xs uppercase tracking-luxury text-gray-500 mb-2">Telephone</p>
                        <a href="tel:01708956609" class="hover:text-sb-gold transition-colors">01708 956609</a>
                    </div>
                    <div>
                        <i class="fas fa-envelope text-sb-gold mb-4 text-2xl block"></i>
                        <p class="text-xs uppercase tracking-luxury text-gray-500 mb-2">Email</p>
                        <a href="mailto:info@sbfloristry.co.uk" class="hover:text-sb-gold transition-colors">info@sbfloristry.co.uk</a>
                    </div>
                </div>
            </section>

            <section class="pb-24 bg-sb-black text-sb-cream border-t border-white/5">
                <div class="container mx-auto px-6 max-w-4xl">
                    <form id="contact-form" class="space-y-8 reveal">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                            <div class="space-y-1">
                                <label class="text-xs font-bold tracking-luxury uppercase text-sb-gold">Name</label>
                                <input type="text" name="name" required class="w-full bg-transparent border-b border-gray-700 focus:border-sb-gold outline-none py-2 transition-colors text-sb-cream placeholder-gray-600 text-base">
                            </div>
                            <div class="space-y-1">
                                <label class="text-xs font-bold tracking-luxury uppercase text-sb-gold">Email</label>
                                <input type="email" name="email" required class="w-full bg-transparent border-b border-gray-700 focus:border-sb-gold outline-none py-2 transition-colors text-sb-cream placeholder-gray-600 text-base">
                            </div>
                        </div>
                        <div class="space-y-1">
                            <label class="text-xs font-bold tracking-luxury uppercase text-sb-gold">Message</label>
                            <textarea name="message" rows="4" required class="w-full bg-transparent border-b border-gray-700 focus:border-sb-gold outline-none py-2 transition-colors text-sb-cream placeholder-gray-600 text-base"></textarea>
                        </div>
                        <div class="text-center pt-8">
                            <button type="submit" class="btn-luxury border border-sb-cream text-sb-cream px-16 py-4 uppercase tracking-luxury text-xs font-bold inline-block">
                                Send Inquiry
                            </button>
                        </div>
                    </form>
                </div>
            </section>
        </div>

    </main>

    <!-- GLOBAL CONTACT FOOTER (Visible on Home Page) -->
    <section class="py-24 bg-sb-black text-sb-cream" id="contact-section">
        <div class="container mx-auto px-6 max-w-4xl">
            <div class="text-center mb-12 reveal">
                <h3 class="font-serif text-5xl md:text-6xl text-sb-cream mb-4 font-light">Start Your Floral Journey</h3>
                <p class="font-light text-gray-400 text-lg">Tell us about your event or custom request.</p>
            </div>
            <!-- Duplicate Form for Home Page Footer -->
            <form id="home-contact-form" class="space-y-8 reveal">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                    <div class="space-y-1">
                        <label class="text-xs font-bold tracking-luxury uppercase text-sb-gold">Name</label>
                        <input type="text" name="name" required class="w-full bg-transparent border-b border-gray-700 focus:border-sb-gold outline-none py-2 transition-colors text-sb-cream placeholder-gray-600 text-base">
                    </div>
                    <div class="space-y-1">
                        <label class="text-xs font-bold tracking-luxury uppercase text-sb-gold">Email</label>
                        <input type="email" name="email" required class="w-full bg-transparent border-b border-gray-700 focus:border-sb-gold outline-none py-2 transition-colors text-sb-cream placeholder-gray-600 text-base">
                    </div>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                    <div class="space-y-1">
                        <label class="text-xs font-bold tracking-luxury uppercase text-sb-gold">Event Date (Optional)</label>
                        <input type="date" name="date" class="w-full bg-transparent border-b border-gray-700 focus:border-sb-gold outline-none py-2 transition-colors text-sb-cream text-gray-400 text-base">
                    </div>
                    <div class="space-y-1">
                        <label class="text-xs font-bold tracking-luxury uppercase text-sb-gold">Interest</label>
                        <select name="interest" class="w-full bg-transparent border-b border-gray-700 focus:border-sb-gold outline-none py-2 transition-colors text-sb-cream text-base">
                            <option value="Weddings" class="bg-sb-black">Weddings</option>
                            <option value="Events" class="bg-sb-black">Events</option>
                            <option value="Subscription" class="bg-sb-black">Subscription</option>
                            <option value="Hotels" class="bg-sb-black">Hotels & Spas</option>
                            <option value="Bespoke Order" class="bg-sb-black">Bespoke Order</option>
                        </select>
                    </div>
                </div>
                <div class="space-y-1">
                    <label class="text-xs font-bold tracking-luxury uppercase text-sb-gold">Message</label>
                    <textarea name="message" rows="4" required class="w-full bg-transparent border-b border-gray-700 focus:border-sb-gold outline-none py-2 transition-colors text-sb-cream placeholder-gray-600 text-base"></textarea>
                </div>
                <div class="text-center pt-8">
                    <button type="submit" class="btn-luxury border border-sb-cream text-sb-cream px-16 py-4 uppercase tracking-luxury text-xs font-bold inline-block">
                        Send Inquiry
                    </button>
                </div>
            </form>
        </div>
    </section>

    <!-- Footer -->
    <footer class="bg-sb-black text-gray-500 pt-20 pb-10 border-t border-white/5">
        <div class="container mx-auto px-6">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-12 mb-16 text-center md:text-left">
                <!-- Brand Column -->
                <div class="col-span-1 md:col-span-1">
                    <h3 class="font-serif text-2xl text-sb-cream mb-6 tracking-widest">SB FLORISTRY</h3>
                    <p class="text-sm font-light leading-relaxed mb-6 text-gray-400">Artistry in every bloom. Mother and daughter team creating bespoke floral designs for Essex and London.</p>
                    <div class="flex justify-center md:justify-start space-x-6 text-sb-gold">
                        <a href="#" class="hover:text-white transition-colors"><i class="fab fa-instagram text-lg"></i></a>
                        <a href="#" class="hover:text-white transition-colors"><i class="fab fa-facebook-f text-lg"></i></a>
                        <a href="#" class="hover:text-white transition-colors"><i class="fab fa-pinterest-p text-lg"></i></a>
                    </div>
                </div>

                <!-- Links Column -->
                <div class="col-span-1">
                    <h4 class="text-xs font-bold text-white uppercase tracking-luxury mb-6">Explore</h4>
                    <ul class="space-y-4 text-sm font-light">
                        <li><a href="#home" class="hover:text-sb-gold transition-colors">Home</a></li>
                        <li><a href="#collection-seasonal" class="hover:text-sb-gold transition-colors">Shop Collections</a></li>
                        <li><a href="#subscriptions" class="hover:text-sb-gold transition-colors">Subscriptions</a></li>
                        <li><a href="#weddings" class="hover:text-sb-gold transition-colors">Weddings & Events</a></li>
                    </ul>
                </div>

                <!-- Customer Care Column -->
                <div class="col-span-1">
                    <h4 class="text-xs font-bold text-white uppercase tracking-luxury mb-6">Customer Care</h4>
                    <ul class="space-y-4 text-sm font-light">
                        <li><a href="#contact" class="hover:text-sb-gold transition-colors">Contact Us</a></li>
                        <li><button onclick="document.getElementById('care-modal').classList.remove('hidden')" class="hover:text-sb-gold transition-colors text-left">Flower Care Guide</button></li>
                    </ul>
                </div>

                <!-- Trust Column -->
                <div class="col-span-1">
                    <h4 class="text-xs font-bold text-white uppercase tracking-luxury mb-6">Our Promise</h4>
                    <div class="space-y-4">
                        <div class="flex items-center justify-center md:justify-start gap-4 text-gray-400">
                            <i class="fas fa-truck text-sb-gold text-lg w-6"></i>
                            <span class="text-sm font-light">Hand Delivered</span>
                        </div>
                        <div class="flex items-center justify-center md:justify-start gap-4 text-gray-400">
                            <i class="fas fa-leaf text-sb-gold text-lg w-6"></i>
                            <span class="text-sm font-light">Freshness Guaranteed</span>
                        </div>
                        <div class="flex items-center justify-center md:justify-start gap-4 text-gray-400">
                            <i class="fas fa-lock text-sb-gold text-lg w-6"></i>
                            <span class="text-sm font-light">Secure Payment</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="border-t border-white/5 pt-8 flex flex-col md:flex-row justify-between items-center text-[10px] tracking-widest uppercase opacity-60 text-gray-500">
                <p>&copy; 2026 SB Floristry. All rights reserved.</p>
                <p class="mt-2 md:mt-0"><a href="https://jsos.net" target="_blank" class="hover:text-sb-gold transition-colors">Website Designed by JSOS.net</a></p>
            </div>
        </div>
    </footer>

    <!-- 8. COOKIE BANNER -->
    <div id="cookie-banner" class="fixed bottom-0 left-0 right-0 bg-sb-black text-sb-cream p-4 z-50 border-t border-gray-800 transform transition-transform duration-500 translate-y-full">
        <div class="container mx-auto flex flex-col md:flex-row justify-between items-center gap-4">
            <p class="text-sm font-light text-gray-400 text-center md:text-left">
                We use cookies to ensure you get the best experience on our website.
            </p>
            <div class="flex gap-4">
                <button onclick="acceptCookies()" class="bg-sb-gold text-sb-black px-6 py-2 uppercase font-bold text-xs tracking-luxury hover:bg-white transition-colors">
                    Accept
                </button>
                <button onclick="acceptCookies()" class="text-gray-400 hover:text-white text-xs uppercase font-bold tracking-luxury">
                    Dismiss
                </button>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script>
        // SHOPIFY BUY SDK LOGIC
        // -------------------------------------------------------------
        // IMPORTANT: Replace the values below with your actual Shopify credentials.
        // -------------------------------------------------------------
        
        const shopifyConfig = {
            domain: 'sb-floristry.myshopify.com', 
            storefrontAccessToken: '35527e42586bf1abcce2dda69206eec9' 
        };
        
        // Form Config
        const emailConfig = { 
            publicKey: "Oaw-LoMGaOOjSh2GO", 
            serviceID: "service_jnmsvja", 
            templateID: "template_9u9b45v" 
        };
        
        // Collection Config
        const collectionTags = [
            { title: 'Seasonal', tag: 'seasonal' },
            { title: 'Luxury', tag: 'luxury' },
            { title: 'Gothic', tag: 'gothic' },
            { title: 'Fairy Tale', tag: 'fairytale' }
        ];
        
        let debounceTimer;

        // Helper to fetch directly from Storefront API
        async function shopifyFetch(query, variables = {}) {
            try {
                const response = await fetch(`https://${shopifyConfig.domain}/api/2024-01/graphql.json`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-Shopify-Storefront-Access-Token': shopifyConfig.storefrontAccessToken
                    },
                    body: JSON.stringify({ query, variables })
                });
                return await response.json();
            } catch (error) {
                console.error("Shopify Fetch Error:", error);
                throw error;
            }
        }

        // Initialize Cart
        async function initCart() {
            let cartId = localStorage.getItem('shopify_cart_id');
            if (!cartId) return null;
            
            const query = `
                query($id: ID!) {
                  cart(id: $id) {
                    id
                    checkoutUrl
                    totalQuantity
                    note
                    attributes { key value }
                    cost {
                        subtotalAmount { amount currencyCode }
                    }
                    lines(first: 10) {
                        edges {
                            node {
                                id
                                quantity
                                merchandise {
                                    ... on ProductVariant {
                                        id
                                        title
                                        price { amount currencyCode }
                                        image { url }
                                        product { title }
                                    }
                                }
                            }
                        }
                    }
                  }
                }
            `;
            
            const result = await shopifyFetch(query, { id: cartId });
            
            if (result.data && result.data.cart) {
                updateCartUI(result.data.cart);
                // Pre-fill inputs from saved cart data
                const noteInput = document.getElementById('cart-note');
                const dateInput = document.getElementById('delivery-date');
                const displayDate = document.getElementById('delivery-date-display');
                
                if (noteInput && result.data.cart.note) {
                    noteInput.value = result.data.cart.note;
                }
                
                if (dateInput && result.data.cart.attributes) {
                    const dateAttr = result.data.cart.attributes.find(a => a.key === 'Requested Delivery Date');
                    if (dateAttr) {
                        dateInput.value = dateAttr.value;
                        if(displayDate) displayDate.value = new Date(dateAttr.value).toDateString();
                    }
                }
                
                return result.data.cart;
            } else {
                localStorage.removeItem('shopify_cart_id');
                return null;
            }
        }
        
        // Create a new cart
        async function createCart() {
            const query = `mutation { cartCreate { cart { id checkoutUrl } } }`;
            const result = await shopifyFetch(query);
            if (result.data && result.data.cartCreate && result.data.cartCreate.cart) {
                const cart = result.data.cartCreate.cart;
                localStorage.setItem('shopify_cart_id', cart.id);
                return cart;
            }
            throw new Error("Failed to create cart");
        }

        // Update Cart Attributes (Note & Date)
        async function updateCartAttributes(note, date) {
            const cartId = localStorage.getItem('shopify_cart_id');
            if (!cartId) return;

            const query = `
                mutation updateCart($cartId: ID!, $note: String, $attributes: [AttributeInput!]) {
                    cartNoteUpdate(cartId: $cartId, note: $note) {
                        cart { id }
                    }
                    cartAttributesUpdate(cartId: $cartId, attributes: $attributes) {
                        cart { id }
                    }
                }
            `;

            // Prepare attributes array. Only add date if it exists.
            const attributes = [];
            if (date) {
                attributes.push({ key: "Requested Delivery Date", value: date });
            }

            try {
                await shopifyFetch(query, {
                    cartId: cartId,
                    note: note || "", 
                    attributes: attributes
                });
                console.log("Cart updated with note/date");
                return true;
            } catch (e) {
                console.error("Failed to update attributes", e);
                return false;
            }
        }

        // CUSTOM DATE PICKER LOGIC
        function initCustomDatePicker() {
            const dateInput = document.getElementById('delivery-date');
            const displayInput = document.getElementById('delivery-date-display');
            const picker = document.getElementById('custom-datepicker');
            const calendarDays = document.getElementById('calendar-days');
            const monthYear = document.getElementById('current-month-year');
            const prevBtn = document.getElementById('prev-month');
            const nextBtn = document.getElementById('next-month');
            const errorMsg = document.getElementById('date-error');

            if (!dateInput || !picker) return;

            let currentDate = new Date();
            let currentMonth = currentDate.getMonth();
            let currentYear = currentDate.getFullYear();

            // Calculate Min Date (Today + 2 days)
            const minDate = new Date();
            minDate.setDate(minDate.getDate() + 2);
            minDate.setHours(0,0,0,0);

            function renderCalendar(month, year) {
                calendarDays.innerHTML = '';
                monthYear.innerText = new Date(year, month).toLocaleString('default', { month: 'long', year: 'numeric' });

                const firstDay = new Date(year, month, 1).getDay();
                const daysInMonth = new Date(year, month + 1, 0).getDate();

                // Empty slots
                for (let i = 0; i < firstDay; i++) {
                    const empty = document.createElement('div');
                    calendarDays.appendChild(empty);
                }

                // Days
                for (let day = 1; day <= daysInMonth; day++) {
                    const dayEl = document.createElement('div');
                    dayEl.innerText = day;
                    dayEl.className = "calendar-day p-2 cursor-pointer rounded-sm hover:bg-gray-100 text-sm";
                    
                    const dateObj = new Date(year, month, day);
                    
                    // Disable Logic
                    if (dateObj < minDate || dateObj.getDay() === 0) {
                        dayEl.classList.add('disabled');
                        dayEl.classList.add('opacity-30');
                        dayEl.classList.remove('cursor-pointer', 'hover:bg-gray-100');
                    } else {
                        dayEl.onclick = () => selectDate(dateObj);
                    }

                    // Highlight Selected
                    if (dateInput.value && new Date(dateInput.value).toDateString() === dateObj.toDateString()) {
                        dayEl.classList.add('selected');
                    }

                    calendarDays.appendChild(dayEl);
                }
            }

            function selectDate(date) {
                const yyyy = date.getFullYear();
                const mm = String(date.getMonth() + 1).padStart(2, '0');
                const dd = String(date.getDate()).padStart(2, '0');
                
                dateInput.value = `${yyyy}-${mm}-${dd}`;
                displayInput.value = date.toDateString();
                picker.classList.add('hidden');
                errorMsg.classList.add('hidden');
                
                // Trigger Cart Update
                handleCartInputUpdate();
            }

            // Events
            displayInput.addEventListener('click', () => picker.classList.toggle('hidden'));
            
            prevBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                currentMonth--;
                if(currentMonth < 0) { currentMonth = 11; currentYear--; }
                renderCalendar(currentMonth, currentYear);
            });

            nextBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                currentMonth++;
                if(currentMonth > 11) { currentMonth = 0; currentYear++; }
                renderCalendar(currentMonth, currentYear);
            });

            // Close when clicking outside
            document.addEventListener('click', (e) => {
                if (!displayInput.contains(e.target) && !picker.contains(e.target)) {
                    picker.classList.add('hidden');
                }
            });

            renderCalendar(currentMonth, currentYear);
        }

        // Handle Date/Note input changes with validation
        function handleCartInputUpdate() {
            const note = document.getElementById('cart-note')?.value;
            const dateInput = document.getElementById('delivery-date');
            
            clearTimeout(debounceTimer);
            debounceTimer = setTimeout(() => {
                if (dateInput?.value) {
                    updateCartAttributes(note, dateInput.value);
                }
            }, 500); 
        }

        // SMART ADD TO CART: Converts Product ID -> Variant ID -> Add to Cart
        async function addToCart(btn, rawProductId) {
            
            // 1. Resolve ID Logic
            let identifier = rawProductId;
            
            // If no ID passed, try to find a handle on the button or parent
            if (!identifier) {
                if (btn.dataset.handle) {
                    identifier = btn.dataset.handle;
                } else {
                    const parent = btn.closest('[data-handle]');
                    if (parent) identifier = parent.dataset.handle;
                }
            }

            if (!identifier) {
                console.error("No product identifier found");
                return;
            }

            let originalText = btn ? btn.innerText : "Add to Cart";
            
            try {
                if(btn) {
                    btn.innerText = "Adding...";
                    btn.disabled = true;
                }

                let variantId = null;

                // 2. Fetch Variant ID via Handle OR ID
                // Query supports both by handle logic or ID
                const productQuery = `
                    query($handle: String!) {
                      productByHandle(handle: $handle) {
                        id
                        variants(first: 1) {
                          nodes {
                            id
                          }
                        }
                      }
                    }
                `;
                
                // Try as handle first (cleanest)
                let productResult = await shopifyFetch(productQuery, { handle: identifier });
                
                if (productResult.data && productResult.data.productByHandle) {
                    variantId = productResult.data.productByHandle.variants.nodes[0].id;
                } else {
                    // Fallback: If it was an ID, convert to GID and try fetching node
                    // (This covers dynamic products loaded via ID)
                    const gid = identifier.includes('gid://') ? identifier : btoa(`gid://shopify/Product/${identifier}`);
                    const idQuery = `
                        query($id: ID!) {
                          product(id: $id) {
                            variants(first: 1) {
                              nodes { id }
                            }
                          }
                        }
                    `;
                    productResult = await shopifyFetch(idQuery, { id: gid });
                    if (productResult.data && productResult.data.product) {
                        variantId = productResult.data.product.variants.nodes[0].id;
                    }
                }

                if (!variantId) throw new Error("Product variant not found");
                
                // 3. Get or Create Cart
                let cart = await initCart();
                if (!cart) {
                    cart = await createCart();
                }
                
                // 4. Add Line Item
                const addLineQuery = `
                    mutation($cartId: ID!, $lines: [CartLineInput!]!) {
                      cartLinesAdd(cartId: $cartId, lines: $lines) {
                        cart {
                          id
                          totalQuantity
                          checkoutUrl
                          cost { subtotalAmount { amount currencyCode } }
                          lines(first: 10) {
                            edges {
                                node {
                                    id
                                    quantity
                                    merchandise {
                                        ... on ProductVariant {
                                            id
                                            title
                                            price { amount currencyCode }
                                            image { url }
                                            product { title }
                                        }
                                    }
                                }
                            }
                        }
                        }
                      }
                    }
                `;
                
                const addResult = await shopifyFetch(addLineQuery, {
                    cartId: cart.id,
                    lines: [{ merchandiseId: variantId, quantity: 1 }]
                });
                
                if (addResult.data && addResult.data.cartLinesAdd && addResult.data.cartLinesAdd.cart) {
                    updateCartUI(addResult.data.cartLinesAdd.cart);
                    if (window.openCart) window.openCart();
                    if(btn) btn.innerText = "Added";
                    setTimeout(() => { if(btn) { btn.innerText = originalText; btn.disabled = false; } }, 2000);
                    return true;
                }
                return false;

            } catch (e) {
                console.error("Error adding to cart:", e);
                alert("Could not add item. Ensure the product exists in Shopify.");
                if(btn) { btn.innerText = originalText; btn.disabled = false; }
                return false;
            }
        }

        async function updateLineItem(lineId, quantity) {
            const cartId = localStorage.getItem('shopify_cart_id');
            if(!cartId) return;

            const query = `
                mutation($cartId: ID!, $lines: [CartLineUpdateInput!]!) {
                    cartLinesUpdate(cartId: $cartId, lines: $lines) {
                        cart {
                            id
                            totalQuantity
                            checkoutUrl
                            cost { subtotalAmount { amount currencyCode } }
                            lines(first: 10) {
                                edges {
                                    node {
                                        id
                                        quantity
                                        merchandise {
                                            ... on ProductVariant {
                                                id
                                                title
                                                price { amount currencyCode }
                                                image { url }
                                                product { title }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            `;
            
            const result = await shopifyFetch(query, {
                cartId: cartId,
                lines: [{ id: lineId, quantity: quantity }]
            });

            if(result.data && result.data.cartLinesUpdate) {
                updateCartUI(result.data.cartLinesUpdate.cart);
            }
        }

        async function removeLineItem(lineId) {
             const cartId = localStorage.getItem('shopify_cart_id');
            if(!cartId) return;

            const query = `
                mutation($cartId: ID!, $lineIds: [ID!]!) {
                    cartLinesRemove(cartId: $cartId, lineIds: $lineIds) {
                        cart {
                            id
                            totalQuantity
                            checkoutUrl
                            cost { subtotalAmount { amount currencyCode } }
                            lines(first: 10) {
                                edges {
                                    node {
                                        id
                                        quantity
                                        merchandise {
                                            ... on ProductVariant {
                                                id
                                                title
                                                price { amount currencyCode }
                                                image { url }
                                                product { title }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            `;
            
            const result = await shopifyFetch(query, {
                cartId: cartId,
                lineIds: [lineId]
            });

            if(result.data && result.data.cartLinesRemove) {
                updateCartUI(result.data.cartLinesRemove.cart);
            }
        }

        function updateCartUI(cart) {
            // Update Badge
            const badge = document.getElementById('cart-count');
            if (badge) {
                badge.innerText = cart.totalQuantity;
                badge.classList.remove('opacity-0');
                if(cart.totalQuantity > 0) {
                    badge.classList.add('scale-150');
                    setTimeout(() => badge.classList.remove('scale-150'), 200);
                }
            }

            // Update Side Cart HTML
            const cartContainer = document.getElementById('cart-items-container');
            const subtotalEl = document.getElementById('cart-subtotal');
            const checkoutBtn = document.getElementById('checkout-btn');
            const shippingBar = document.getElementById('shipping-bar');
            const shippingMessage = document.getElementById('shipping-message');
            const cartExtras = document.getElementById('cart-extras');

            if (cartContainer && cart.cost) {
                 const amount = parseFloat(cart.cost.subtotalAmount.amount);
                 if (subtotalEl) subtotalEl.innerText = `£${amount.toFixed(2)}`;
                 
                 // Show/Hide Extras based on items
                 const hasItems = cart.lines.edges.length > 0;

                 if (hasItems && cartExtras) {
                    cartExtras.classList.remove('hidden');
                 } else if (cartExtras) {
                    cartExtras.classList.add('hidden');
                 }

                 // Update Free Delivery Bar
                 const freeDeliveryThreshold = 60;
                 if (shippingBar && shippingMessage) {
                     let percentage = (amount / freeDeliveryThreshold) * 100;
                     if (percentage > 100) percentage = 100;
                     
                     shippingBar.style.width = `${percentage}%`;
                     
                     if (amount >= freeDeliveryThreshold) {
                         shippingBar.classList.add('bg-green-500');
                         shippingBar.classList.remove('bg-sb-gold');
                         shippingMessage.innerHTML = 'You have unlocked <span class="text-green-600">Free Delivery!</span>';
                     } else {
                         shippingBar.classList.add('bg-sb-gold');
                         shippingBar.classList.remove('bg-green-500');
                         const remaining = (freeDeliveryThreshold - amount).toFixed(2);
                         shippingMessage.innerHTML = `Spend <span class="text-sb-gold">£${remaining}</span> more for Free Delivery`;
                     }
                 }
            }

            // Bind Checkout Button - UPDATED LOGIC
            if (checkoutBtn) {
                const newBtn = checkoutBtn.cloneNode(true);
                checkoutBtn.parentNode.replaceChild(newBtn, checkoutBtn);
                
                if (cart.lines.edges.length === 0) {
                     newBtn.innerText = "Browse Seasonal Collection";
                     newBtn.onclick = () => {
                         window.closeCart();
                         const shopEl = document.getElementById('view-dynamic-collection');
                         if(shopEl) {
                             window.location.hash = "#collection-seasonal";
                         }
                     };
                } else if (cart.checkoutUrl) {
                    newBtn.innerText = "Proceed to Checkout";
                    
                    newBtn.onclick = async () => {
                        const noteInput = document.getElementById('cart-note');
                        const dateInput = document.getElementById('delivery-date');
                        const note = noteInput?.value.trim();
                        const date = dateInput?.value;

                        // 1. Mandatory Date Check
                        if (!date) {
                            alert("Please select a delivery date to proceed.");
                            document.getElementById('delivery-date-display').focus();
                            return;
                        }

                        // 3. Gift Message Reminder (Soft Check)
                        if (!note) {
                            const confirmNoMessage = confirm("You haven't written a gift message. Are you sure you want to proceed without one?");
                            if (!confirmNoMessage) {
                                noteInput.focus();
                                return;
                            }
                        }

                        // Proceed if checks pass
                        newBtn.innerText = "Processing...";
                        newBtn.disabled = true;
                        
                        // Force update of Note and Date before redirecting
                        await updateCartAttributes(note, date);
                        
                        // Redirect
                        window.location.href = cart.checkoutUrl;
                    };
                }
            }

            // Render Items
            if (cartContainer) {
                if (cart.lines.edges.length === 0) {
                    cartContainer.innerHTML = `
                        <div class="flex flex-col items-center justify-center h-full text-gray-400 space-y-4 pt-10">
                            <i class="fas fa-shopping-basket text-3xl text-sb-gold opacity-50"></i>
                            <p>Your cart is empty.</p>
                        </div>
                    `;
                } else {
                    cartContainer.innerHTML = cart.lines.edges.map(edge => {
                        const item = edge.node;
                        return `
                            <div class="flex items-center gap-4 mb-6 border-b border-gray-100 pb-4">
                                <div class="w-20 h-24 flex-shrink-0 bg-gray-50">
                                    <img src="${item.merchandise.image?.url || 'images/placeholder.jpg'}" class="w-full h-full object-cover loaded" style="opacity: 1;">
                                </div>
                                <div class="flex-1">
                                    <h4 class="font-serif text-lg text-sb-black leading-tight mb-1">${item.merchandise.product.title}</h4>
                                    <p class="text-xs text-gray-500 mb-2">£${item.merchandise.price.amount}</p>
                                    <div class="flex items-center gap-4">
                                        <div class="flex items-center border border-gray-200">
                                            <button onclick="updateLineItem('${item.id}', ${item.quantity - 1})" class="px-2 py-1 text-gray-500 hover:text-sb-black">-</button>
                                            <span class="px-2 text-xs font-bold">${item.quantity}</span>
                                            <button onclick="updateLineItem('${item.id}', ${item.quantity + 1})" class="px-2 py-1 text-gray-500 hover:text-sb-black">+</button>
                                        </div>
                                        <button onclick="removeLineItem('${item.id}')" class="text-xs text-gray-400 hover:text-red-500 underline">Remove</button>
                                    </div>
                                </div>
                            </div>
                        `;
                    }).join('');
                }
            }
        }

        // Global function refs for inline HTML onclicks
        window.updateLineItem = updateLineItem;
        window.removeLineItem = removeLineItem;
        window.addToCart = addToCart;

        // DOM Elements & Event Listeners
        document.addEventListener('DOMContentLoaded', () => {
            
            // Side Cart Open/Close Logic
            const sideCart = document.getElementById('side-cart');
            const sideCartOverlay = document.getElementById('side-cart-overlay');
            const closeCartBtn = document.getElementById('close-cart-btn');
            const cartIconBtn = document.getElementById('cart-icon-btn');
            const cartNote = document.getElementById('cart-note');

            // Initialize custom date picker
            initCustomDatePicker();

            // Random Subscription Image
            updateSubscriptionImage();

            if (cartNote) cartNote.addEventListener('input', handleCartInputUpdate);
            
            window.openCart = function() {
                if (sideCartOverlay && sideCart) {
                    sideCartOverlay.classList.remove('hidden');
                    setTimeout(() => {
                        sideCartOverlay.classList.remove('opacity-0');
                        sideCart.classList.remove('translate-x-full');
                    }, 10);
                }
            };

            window.closeCart = function() {
                if (sideCart && sideCartOverlay) {
                    sideCart.classList.add('translate-x-full');
                    sideCartOverlay.classList.add('opacity-0');
                    setTimeout(() => {
                        sideCartOverlay.classList.add('hidden');
                    }, 300);
                }
            };

            if (cartIconBtn) cartIconBtn.addEventListener('click', window.openCart);
            if (closeCartBtn) closeCartBtn.addEventListener('click', window.closeCart);
            if (sideCartOverlay) sideCartOverlay.addEventListener('click', window.closeCart);
            
            // Event Listeners for Add Buttons
            document.querySelectorAll('.shopify-add-btn').forEach(btn => {
                btn.addEventListener('click', async (e) => {
                    const id = btn.getAttribute('data-shopify-id');
                    if (id) {
                       await addToCart(btn, id);
                    }
                });
            });

            // Init Cart
            initCart();
            
            // Init Routing & Dynamic Content
            // initDynamicNav(); // REMOVED as we are hardcoding menu to avoid empty issue
            window.addEventListener('hashchange', handleRoute);
            handleRoute();
            setupForms();
            
            // Mobile Menu
            const mobileMenuBtn = document.getElementById('mobile-menu-btn');
            const closeMenuBtn = document.getElementById('close-menu-btn');
            const mobileMenu = document.getElementById('mobile-menu');
            const menuLinks = mobileMenu ? mobileMenu.querySelectorAll('a') : [];

            function toggleMenu() {
                if (!mobileMenu) return;
                const isClosed = mobileMenu.classList.contains('-translate-x-full');
                if (isClosed) {
                    mobileMenu.classList.remove('-translate-x-full');
                    document.body.style.overflow = 'hidden'; 
                } else {
                    mobileMenu.classList.add('-translate-x-full');
                    document.body.style.overflow = 'auto'; 
                }
            }

            if (mobileMenuBtn) mobileMenuBtn.addEventListener('click', toggleMenu);
            if (closeMenuBtn) closeMenuBtn.addEventListener('click', toggleMenu);
            menuLinks.forEach(link => link.addEventListener('click', toggleMenu));

            // Scroll Animation Observer
            const observerOptions = { root: null, rootMargin: '100px', threshold: 0.1 };
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) entry.target.classList.add('active');
                });
            }, observerOptions);
            document.querySelectorAll('.reveal').forEach((el) => observer.observe(el));

            // Cookie Banner Logic
            window.acceptCookies = function() {
                const banner = document.getElementById('cookie-banner');
                if (banner) {
                    banner.classList.remove('translate-y-0');
                    banner.classList.add('translate-y-full');
                    localStorage.setItem('cookiesAccepted', 'true');
                }
            }

            if (!localStorage.getItem('cookiesAccepted')) {
                setTimeout(() => {
                    const banner = document.getElementById('cookie-banner');
                    if (banner) {
                        banner.classList.remove('translate-y-full');
                        banner.classList.add('translate-y-0');
                    }
                }, 2000); 
            }
        });

        function handleRoute() {
            let hash = window.location.hash.substring(1) || 'home';
            if (hash === 'contact') {
                switchView('view-contact');
                const contactFooter = document.getElementById('contact-section');
                if(contactFooter) contactFooter.style.display = 'none';
                return;
            } else {
                const contactFooter = document.getElementById('contact-section');
                if(contactFooter) contactFooter.style.display = 'block';
            }

            if (hash.startsWith('collection-')) {
                const tag = hash.replace('collection-', '');
                renderDynamicCollection(tag);
                switchView('view-dynamic-collection');
            } else {
                const viewMap = {
                    'home': 'view-home',
                    'weddings': 'view-weddings',
                    'funerals': 'view-funerals',
                    'babyshowers': 'view-babyshowers',
                    'genderreveal': 'view-genderreveal',
                    'workevents': 'view-workevents',
                    'subscriptions': 'view-subscriptions'
                };
                const target = viewMap[hash] || 'view-home';
                switchView(target);
            }
        }

        function switchView(id) {
            document.querySelectorAll('.view-section').forEach(section => {
                if (section.id === id) {
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                    setTimeout(() => section.classList.add('active-view'), 50);
                } else {
                    section.classList.remove('active-view');
                }
            });
        }

        async function renderDynamicCollection(tag) {
            const titleEl = document.getElementById('dynamic-title');
            const gridEl = document.getElementById('dynamic-grid');
            const descEl = document.getElementById('dynamic-desc');
            const heroEl = document.getElementById('dynamic-hero');
            const bgEl = document.getElementById('dynamic-bg');

            if(!titleEl || !gridEl) return;

            const configItem = collectionTags.find(c => c.tag === tag);
            const displayTitle = configItem ? configItem.title : tag.toUpperCase();

            titleEl.innerText = displayTitle;
            descEl.innerText = "Curating blooms...";
            gridEl.innerHTML = `<div class="col-span-full text-center py-12"><div class="loader"></div></div>`;
            
            if (tag.includes('gothic') || tag.includes('dark')) {
                heroEl.className = "pt-40 pb-20 bg-sb-black text-center";
                bgEl.className = "pb-24 bg-sb-black";
                titleEl.className = "font-serif text-6xl md:text-8xl mb-6 font-light text-sb-cream";
            } else {
                heroEl.className = "pt-40 pb-20 bg-sb-cream text-center";
                bgEl.className = "pb-24 bg-sb-cream";
                titleEl.className = "font-serif text-6xl md:text-8xl mb-6 font-light text-sb-black";
            }

            const query = `{
              products(first: 20, query: "tag:${tag}") {
                edges {
                  node {
                    id
                    title
                    handle
                    description
                    images(first: 1) {
                      edges {
                        node { url altText }
                      }
                    }
                    variants(first: 1) {
                      edges {
                        node { id price { amount currencyCode } }
                      }
                    }
                  }
                }
              }
            }`;

            try {
                const data = await shopifyFetch(query);
                const products = data?.data?.products?.edges || [];
                
                descEl.innerText = `The ${displayTitle} Collection`;

                if(products.length === 0) {
                    gridEl.innerHTML = `<p class="col-span-full text-center text-gray-500">No products found for tag: #${tag}</p>`;
                } else {
                    const isDark = tag.includes('gothic') || tag.includes('dark');
                    gridEl.innerHTML = products.map(edge => createProductCard(edge.node, isDark)).join('');
                    
                    setTimeout(() => {
                        gridEl.querySelectorAll('img').forEach(img => {
                            if (img.complete) img.classList.add('loaded');
                            else img.addEventListener('load', () => img.classList.add('loaded'));
                        });
                    }, 10);
                }
            } catch (err) {
                console.error(err);
                gridEl.innerHTML = `<p class="col-span-full text-center text-red-400">Error loading products.</p>`;
            }
        }

        // Random Subscription Image Fetcher
        async function updateSubscriptionImage() {
            const imgEl = document.getElementById('subscription-hero-image');
            if (!imgEl) return;

            // Fetch a batch of products to pick from
            const query = `{
              products(first: 20, query: "tag:seasonal OR tag:luxury") {
                edges {
                  node {
                    images(first: 1) {
                      edges {
                        node { url }
                      }
                    }
                  }
                }
              }
            }`;

            try {
                const data = await shopifyFetch(query);
                const products = data?.data?.products?.edges || [];
                // Filter products that actually have images
                const validProducts = products.filter(p => p.node.images.edges.length > 0);
                
                if (validProducts.length > 0) {
                    const randomProduct = validProducts[Math.floor(Math.random() * validProducts.length)];
                    const newSrc = randomProduct.node.images.edges[0].node.url;
                    imgEl.src = newSrc;
                }
            } catch (err) {
                console.warn("Could not fetch random subscription image", err);
            }
        }

        function createProductCard(product, isDarkTheme) {
            const price = product.variants.edges[0]?.node?.price;
            const priceText = price ? `£${price.amount}` : '£0.00';
            const img = product.images.edges[0]?.node?.url || 'images/placeholder.jpg';
            const rawId = product.id.split('/').pop(); 
            
            // SANITIZE STRINGS
            const safeTitle = product.title.replace(/"/g, '&quot;');
            const safeDesc = (product.description || "").replace(/"/g, '&quot;');
            
            const textClass = isDarkTheme ? "text-sb-cream" : "text-sb-black";
            const subText = isDarkTheme ? "text-sb-gold" : "text-gray-500";
            const btnBg = isDarkTheme ? "bg-sb-cream text-sb-black" : "bg-white/90 text-sb-black";
            const border = isDarkTheme ? "border border-white/10" : "";

            return `
             <div class="group relative reveal active" data-title="${safeTitle}" data-price="${priceText}" data-image="${img}" data-description="${safeDesc}" data-shopify-id="${rawId}">
                 <div class="relative overflow-hidden mb-4 aspect-[4/5] group-image-container ${border}">
                     <img src="${img}" alt="${safeTitle}" class="w-full h-full object-cover transition-transform duration-700 group-hover:scale-105" onerror="this.style.opacity=1; this.src='images/placeholder.jpg'">
                     <button onclick="openQuickView(this)" class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 bg-white/90 text-sb-black w-10 h-10 rounded-full flex items-center justify-center opacity-0 group-hover:opacity-100 transition duration-300 z-20 hover:bg-sb-gold"><i class="fas fa-eye"></i></button>
                     <button class="absolute bottom-0 left-0 w-full ${btnBg} py-4 translate-y-full group-hover:translate-y-0 transition-transform duration-300 font-bold tracking-luxury text-[10px] uppercase" onclick="addToCart(this, '${rawId}')">Add to Cart</button>
                 </div>
                 <h4 class="font-serif text-2xl ${textClass} mb-1 font-light">${product.title}</h4>
                 <p class="font-medium ${subText} text-base">${priceText}</p>
             </div>`;
        }

        function openQuickView(el) {
            const p = el.closest('.group');
            document.getElementById('qv-title').innerText = p.dataset.title;
            document.getElementById('qv-price').innerText = p.dataset.price;
            document.getElementById('qv-description').innerText = p.dataset.description;
            document.getElementById('qv-image').src = p.dataset.image;
            document.getElementById('qv-add-btn').setAttribute('data-shopify-id', p.dataset.shopifyId);
            document.getElementById('quick-view-modal').classList.remove('hidden');
        }
        function closeQuickView() { document.getElementById('quick-view-modal').classList.add('hidden'); }

        function setupForms() {
            if (typeof emailjs !== 'undefined') emailjs.init(emailConfig.publicKey);
            ['contact-form', 'home-contact-form'].forEach(id => {
                const f = document.getElementById(id);
                if(f) f.addEventListener('submit', function(e) {
                    e.preventDefault();
                    const btn = this.querySelector('button[type="submit"]');
                    const ogText = btn.innerText;
                    btn.innerText = "Sending..."; btn.disabled = true;
                    emailjs.sendForm(emailConfig.serviceID, emailConfig.templateID, this)
                        .then(() => { alert('Message Sent!'); btn.innerText = ogText; btn.disabled = false; this.reset(); }, 
                              () => { alert('Error sending message.'); btn.innerText = ogText; btn.disabled = false; });
                });
            });
        }
    </script>
</body>
</html>


