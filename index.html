<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- 1. SEO META TAGS -->
    <meta name="description" content="SB Floristry is a premier mother and daughter florist team serving Essex and London. Specializing in luxury seasonal bouquets, weddings, and bespoke floral installations.">
    <meta name="keywords" content="Florist Essex, Luxury Flowers London, Wedding Florist, Mother Daughter Florist, Bespoke Floral Design">
    <meta name="author" content="SB Floristry">
    <meta property="og:title" content="SB Floristry | Essex & London's Premier Florists">
    <meta property="og:description" content="Artistry in every bloom. Hand-tied in Essex, delivered to London.">
    <meta property="og:image" content="images/hero.jpg">
    
    <title>SB Floristry | Essex & London's Premier Mother-Daughter Florists</title>
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&family=Playfair+Display:ital,wght@0,400;0,600;0,700;1,400&display=swap" rel="stylesheet">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- FontAwesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- Tailwind Config -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'sb-black': '#0a0a0a', 
                        'sb-gold': '#E0C35D', 
                        'sb-cream': '#F2F0EB', 
                        'sb-dark': '#1A1A1A',
                    },
                    fontFamily: {
                        serif: ['"Playfair Display"', 'serif'],
                        sans: ['"Lato"', 'sans-serif'],
                    },
                    letterSpacing: {
                        'luxury': '0.2em', 
                    },
                    animation: {
                        'fade-in-up': 'fadeInUp 0.8s ease-out forwards',
                        'bounce-slow': 'bounce 2s infinite',
                    },
                    keyframes: {
                        fadeInUp: {
                            '0%': { opacity: '0', transform: 'translateY(20px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' },
                        }
                    }
                }
            }
        }
    </script>

    <style>
        /* Custom Utilities */
        .text-shadow {
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }
        
        .hero-zoom {
            animation: slowZoom 20s infinite alternate;
        }
        @keyframes slowZoom {
            from { transform: scale(1); }
            to { transform: scale(1.1); }
        }

        .text-gold-metallic {
            background: linear-gradient(to right, #bf953f, #fcf6ba, #b38728, #fbf5b7, #aa771c);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            text-shadow: 0px 1px 2px rgba(0,0,0,0.1); 
        }

        @keyframes subtleShimmer {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .bg-gold-shimmer {
            background: linear-gradient(
                90deg, 
                #997b3a 0%,   
                #b89546 25%,  
                #E0C35D 50%,  
                #b89546 75%,  
                #997b3a 100%  
            );
            background-size: 200% auto;
            animation: subtleShimmer 6s linear infinite;
        }
        
        /* Staggered Reveal Animation */
        .reveal {
            opacity: 0;
            transform: translateY(30px);
            transition: all 1s ease-out;
        }
        .reveal.active {
            opacity: 1;
            transform: translateY(0);
        }

        /* Image Fade In */
        img {
            opacity: 0; 
            transition: opacity 1.2s ease-out; 
        }
        img.loaded {
            opacity: 1;
        }

        /* Selection Color */
        ::selection {
            background: #E0C35D; 
            color: #0a0a0a; 
        }

        /* Luxury Button Hover Effect */
        .btn-luxury {
            position: relative;
            overflow: hidden;
            transition: color 0.3s;
            z-index: 1;
        }
        .btn-luxury::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: #E0C35D; /* sb-gold */
            z-index: -1;
            transform: scaleY(0);
            transform-origin: bottom;
            transition: transform 0.3s ease-out;
        }
        .btn-luxury:hover::before {
            transform: scaleY(1);
        }
        .btn-luxury:hover {
            color: #0a0a0a !important; /* sb-black */
            border-color: #E0C35D;
        }
        
        /* Side Cart Styles */
        .cart-overlay {
            background-color: rgba(0,0,0,0.5);
            backdrop-filter: blur(2px);
        }
        /* Hide scrollbar in cart */
        .cart-scroll::-webkit-scrollbar {
            width: 6px;
        }
        .cart-scroll::-webkit-scrollbar-track {
            background: #F2F0EB; 
        }
        .cart-scroll::-webkit-scrollbar-thumb {
            background: #E0C35D; 
            border-radius: 3px;
        }

        /* FAQ Accordion Styles */
        details > summary {
            list-style: none;
        }
        details > summary::-webkit-details-marker {
            display: none;
        }
        details[open] summary ~ * {
            animation: sweep .3s ease-in-out;
        }
        @keyframes sweep {
            0%    {opacity: 0; transform: translateY(-10px)}
            100%  {opacity: 1; transform: translateY(0)}
        }
    </style>
</head>
<body class="font-sans text-sb-dark antialiased bg-sb-cream">

    <!-- Announcement Bar -->
    <div class="bg-gold-shimmer text-sb-black text-xs md:text-sm py-3.5 px-4 text-center tracking-[0.2em] uppercase font-bold border-b border-sb-cream/20">
        <p>Family Run • Serving Essex & London • Same Day Delivery</p>
    </div>

    <!-- Header / Navigation (Black) -->
    <header class="sticky top-0 z-50 bg-sb-black/95 backdrop-blur-md shadow-lg transition-all duration-300 border-b border-sb-cream/10" id="main-header">
        <div class="container mx-auto px-6 py-2">
            <!-- Grid Layout -->
            <div class="grid grid-cols-[1fr_auto_1fr] items-center h-24 md:h-32 gap-4 lg:gap-12">
                
                <!-- Left Section -->
                <div class="flex items-center justify-start lg:justify-end h-full">
                    <button id="mobile-menu-btn" class="lg:hidden text-2xl text-sb-cream focus:outline-none hover:text-sb-gold transition-colors mr-auto p-2">
                        <i class="fas fa-bars"></i>
                    </button>
                    <nav class="hidden lg:flex space-x-6 xl:space-x-8 text-xs xl:text-sm font-bold tracking-luxury text-gray-300 uppercase whitespace-nowrap">
                        <a href="#shop" class="hover:text-sb-gold transition-colors duration-300">Shop</a>
                        <a href="#weddings" class="hover:text-sb-gold transition-colors duration-300">Weddings</a>
                        <a href="#about" class="hover:text-sb-gold transition-colors duration-300">Our Story</a>
                    </nav>
                </div>

                <!-- Center Section: Logo -->
                <div class="flex justify-center h-full items-center px-4">
                    <a href="#" class="group block">
                        <img src="images/logo.png" alt="SB Floristry" class="h-20 md:h-28 w-auto object-contain transition-transform duration-300 group-hover:scale-105">
                    </a>
                </div>

                <!-- Right Section -->
                <div class="flex items-center justify-end lg:justify-between h-full w-full">
                    <nav class="hidden lg:flex space-x-6 xl:space-x-8 text-xs xl:text-sm font-bold tracking-luxury text-gray-300 uppercase whitespace-nowrap">
                        <a href="#subscriptions" class="hover:text-sb-gold transition-colors duration-300">Subscriptions</a>
                        <a href="#contact-section" class="hover:text-sb-gold transition-colors duration-300">Contact</a>
                    </nav>

                    <!-- Icons -->
                    <div class="flex items-center space-x-6 text-sb-cream">
                        <button class="hidden lg:block hover:text-sb-gold transition-colors"><i class="fas fa-search text-xl"></i></button>
                        
                        <button id="cart-icon-btn" class="relative hover:text-sb-gold transition-colors group p-2">
                            <i class="fas fa-shopping-bag text-xl"></i>
                            <span id="cart-count" class="absolute -top-2 -right-2 bg-gradient-to-r from-yellow-600 to-yellow-400 text-black font-bold text-[10px] w-4 h-4 rounded-full flex items-center justify-center opacity-0 transition-opacity duration-300">0</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Mobile Menu Overlay -->
    <div id="mobile-menu" class="fixed inset-0 bg-sb-black z-[100] transform -translate-x-full transition-transform duration-500 ease-in-out lg:hidden flex flex-col pt-20 px-8">
        <button id="close-menu-btn" class="absolute top-6 right-6 text-3xl text-sb-cream hover:text-sb-gold transition-colors p-2">
            <i class="fas fa-times"></i>
        </button>
        <nav class="flex flex-col space-y-8 text-2xl font-serif text-sb-cream text-center mt-10">
            <a href="#shop" class="border-b border-sb-cream/10 pb-4 hover:text-sb-gold transition-colors">Shop Flowers</a>
            <a href="#weddings" class="border-b border-sb-cream/10 pb-4 hover:text-sb-gold transition-colors">Weddings & Events</a>
            <a href="#about" class="border-b border-sb-cream/10 pb-4 hover:text-sb-gold transition-colors">About Us</a>
            <a href="#subscriptions" class="border-b border-sb-cream/10 pb-4 hover:text-sb-gold transition-colors">Subscriptions</a>
            <a href="#contact-section" class="border-b border-sb-cream/10 pb-4 hover:text-sb-gold transition-colors">Contact</a>
        </nav>
        <div class="mt-auto mb-10 text-center text-gray-400 text-sm tracking-widest uppercase">
            <p class="mb-2">Mother & Daughter Team</p>
            <p class="text-sb-gold">Essex & London</p>
        </div>
    </div>

    <!-- SIDE CART DRAWER -->
    <!-- UPDATED STRUCTURE FOR MOBILE SCROLLING -->
    <div id="side-cart-overlay" class="fixed inset-0 cart-overlay z-[150] hidden opacity-0 transition-opacity duration-300"></div>
    <div id="side-cart" class="fixed top-0 right-0 h-full w-full max-w-md bg-white z-[160] transform translate-x-full transition-transform duration-300 shadow-2xl flex flex-col">
        
        <!-- 1. Cart Header (Fixed Top) -->
        <div class="shrink-0 p-6 border-b border-gray-100 flex justify-between items-center bg-sb-black text-sb-cream">
            <h2 class="font-serif text-2xl">Your Selection</h2>
            <button id="close-cart-btn" class="text-sb-gold hover:text-white transition-colors text-2xl">
                <i class="fas fa-times"></i>
            </button>
        </div>

        <!-- 2. Free Delivery Bar (Fixed Top) -->
        <div class="shrink-0 px-6 py-4 bg-gray-50 border-b border-gray-100">
             <p id="shipping-message" class="text-xs font-bold text-center text-sb-black mb-2">
                 Spend <span class="text-sb-gold">£60.00</span> more for Free Delivery
             </p>
             <div class="w-full bg-gray-200 h-1.5 rounded-full overflow-hidden">
                 <div id="shipping-bar" class="bg-sb-gold h-full rounded-full transition-all duration-500" style="width: 0%"></div>
             </div>
        </div>
        
        <!-- 3. SCROLLABLE MIDDLE SECTION -->
        <div class="flex-1 overflow-y-auto cart-scroll bg-white">
            <!-- Cart Items -->
            <div id="cart-items-container" class="p-6 pb-2">
                <!-- Loading State -->
                <div class="flex flex-col items-center justify-center h-32 text-gray-400 space-y-4">
                    <i class="fas fa-spinner fa-spin text-3xl text-sb-gold"></i>
                    <p>Loading your blooms...</p>
                </div>
            </div>

            <!-- Upsell Section (Scrolls with items) -->
            <div id="upsell-section" class="px-6 py-4 bg-sb-cream/50 border-t border-gray-100 hidden">
                <h5 class="text-xs font-bold uppercase tracking-luxury text-gray-500 mb-3">Don't Forget</h5>
                <div class="flex items-center gap-3 bg-white p-2 rounded shadow-sm border border-gray-100">
                    <div class="w-12 h-12 bg-gray-100 flex-shrink-0">
                         <img src="images/product-pure-elegance.jpg" class="w-full h-full object-cover">
                    </div>
                    <div class="flex-1">
                        <p class="text-sm font-serif text-sb-black">Luxury Glass Vase</p>
                        <p class="text-xs text-sb-gold font-bold">£15.00</p>
                    </div>
                    <button class="shopify-add-btn text-xs bg-sb-black text-white px-3 py-1.5 hover:bg-sb-gold transition-colors" data-shopify-id="YOUR_VASE_PRODUCT_ID">Add</button>
                </div>
            </div>

            <!-- Inputs (Scrolls with items) -->
            <div id="cart-extras" class="px-6 py-6 bg-sb-cream border-t border-gray-100 hidden">
                <div class="mb-4">
                    <label for="cart-note" class="block text-xs font-bold tracking-luxury uppercase text-gray-500 mb-1">Gift Message / Note</label>
                    <textarea id="cart-note" rows="2" class="w-full bg-white border border-gray-300 p-2 text-sm text-sb-black placeholder-gray-400 focus:border-sb-gold outline-none resize-none" placeholder="Write a message for the card..."></textarea>
                </div>

                <div class="mb-0">
                    <label for="delivery-date" class="block text-xs font-bold tracking-luxury uppercase text-gray-500 mb-1">Requested Delivery Date</label>
                    <input type="date" id="delivery-date" class="w-full bg-white border border-gray-300 p-2 text-sm text-sb-black focus:border-sb-gold outline-none">
                    <p id="date-error" class="text-[10px] text-red-500 mt-1 hidden">We do not deliver on Sundays. Please select another date.</p>
                </div>
            </div>
        </div>

        <!-- 4. Sticky Footer (Fixed Bottom) -->
        <div class="shrink-0 p-6 border-t border-gray-100 bg-white shadow-[0_-4px_6px_-1px_rgba(0,0,0,0.05)]">
            <div class="flex justify-between items-center mb-4">
                <span class="text-sm font-bold tracking-luxury uppercase text-gray-500">Subtotal</span>
                <span id="cart-subtotal" class="font-serif text-2xl text-sb-black">£0.00</span>
            </div>
            <p class="text-xs text-gray-400 mb-4 text-center">Shipping & taxes calculated at checkout.</p>
            <button id="checkout-btn" class="w-full btn-luxury bg-sb-black text-sb-cream py-4 uppercase tracking-luxury text-xs font-bold border border-sb-black">
                Proceed to Checkout
            </button>
        </div>
    </div>

    <!-- Hero Section -->
    <section class="relative h-[85vh] overflow-hidden">
        <div class="absolute inset-0">
            <img src="images/hero.jpg" 
                 alt="Luxury Bouquet" 
                 class="w-full h-full object-cover hero-zoom"
                 style="object-position: center 60%;">
            <div class="absolute inset-0 bg-gradient-to-t from-black via-black/40 to-transparent opacity-90"></div>
        </div>

        <div class="relative z-10 container mx-auto px-6 h-full flex flex-col justify-center items-center text-center text-sb-cream pt-24 pb-24">
            <h2 class="text-sm md:text-base tracking-luxury uppercase mb-6 font-bold text-sb-cream reveal">Hand-Tied in Essex • Delivered to London</h2>
            <h1 class="font-serif text-5xl md:text-7xl lg:text-8xl mb-12 leading-none drop-shadow-2xl reveal">
                Artistry in <br/><span class="italic font-light text-gold-metallic">Every Bloom</span>
            </h1>
            <a href="#shop" class="reveal btn-luxury border border-sb-cream text-sb-cream px-12 py-4 uppercase tracking-luxury text-sm font-bold mb-8">
                Shop The Collection
            </a>
            
            <div class="absolute bottom-10 left-1/2 transform -translate-x-1/2 animate-bounce-slow opacity-80">
                <i class="fas fa-chevron-down text-sb-gold text-2xl"></i>
            </div>
        </div>
    </section>

    <!-- Introduction / USP (Black) -->
    <section class="py-16 md:py-24 bg-sb-black text-sb-cream relative">
        <div class="container mx-auto px-6 text-center max-w-3xl">
            <span class="text-gold-metallic text-4xl mb-6 block reveal"><i class="fas fa-leaf"></i></span>
            <h2 class="font-serif text-3xl md:text-4xl text-sb-cream mb-8 reveal">A Family Affair</h2>
            <p class="text-gray-400 leading-relaxed text-xl font-light mb-12 reveal">
                Welcome to SB Floristry. We are a mother and daughter team bringing bespoke, luxury floral design to weddings, events, and homes across Essex and London. Every arrangement is hand-selected and styled with the care only family can provide.
            </p>
            <div class="flex flex-col md:flex-row justify-center gap-10 text-sm font-bold tracking-luxury text-sb-cream uppercase reveal">
                <div class="flex items-center justify-center"><i class="fas fa-truck mr-4 text-sb-gold"></i> London & Essex Delivery</div>
                <div class="flex items-center justify-center"><i class="fas fa-heart mr-4 text-sb-gold"></i> Family Owned</div>
            </div>
        </div>
    </section>

    <!-- Shop by Category Grid -->
    <section class="py-16 md:py-24 bg-sb-cream" id="shop">
        <div class="container mx-auto px-6">
            <div class="text-center mb-12 reveal">
                <h3 class="font-serif text-4xl md:text-5xl text-sb-black mb-4">Shop Our Collections</h3>
                <div class="w-24 h-0.5 bg-sb-gold mx-auto mt-4"></div>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 md:gap-8">
                <!-- Card 1 -->
                <a href="#" class="group relative block h-[450px] overflow-hidden cursor-pointer reveal shadow-lg hover:shadow-2xl transition-shadow duration-300">
                    <img src="images/collection-signature.jpg" alt="Signature Bouquets" class="w-full h-full object-cover transition-all duration-1000 group-hover:scale-110">
                    <div class="absolute inset-0 bg-black/20 group-hover:bg-black/40 transition-colors duration-500"></div>
                    <div class="absolute inset-0 flex flex-col items-center justify-center text-center">
                        <h4 class="font-serif text-4xl text-sb-cream mb-4 translate-y-4 group-hover:translate-y-0 transition-transform duration-500">Signature Bouquets</h4>
                        <span class="text-sb-cream text-sm tracking-luxury uppercase border-b border-sb-cream pb-1 opacity-0 group-hover:opacity-100 transition-opacity duration-500 delay-100">View Collection</span>
                    </div>
                </a>

                <!-- Card 2 -->
                <a href="#" class="group relative block h-[450px] overflow-hidden cursor-pointer reveal shadow-lg hover:shadow-2xl transition-shadow duration-300">
                    <img src="images/collection-seasonal.jpg" alt="Seasonal Edit" class="w-full h-full object-cover transition-all duration-1000 group-hover:scale-110">
                    <div class="absolute inset-0 bg-black/20 group-hover:bg-black/40 transition-colors duration-500"></div>
                    <div class="absolute inset-0 flex flex-col items-center justify-center text-center">
                        <h4 class="font-serif text-4xl text-sb-cream mb-4 translate-y-4 group-hover:translate-y-0 transition-transform duration-500">Seasonal Releases</h4>
                        <span class="text-sb-cream text-sm tracking-luxury uppercase border-b border-sb-cream pb-1 opacity-0 group-hover:opacity-100 transition-opacity duration-500 delay-100">View Collection</span>
                    </div>
                </a>

                <!-- Card 3 -->
                <a href="#" class="group relative block h-[450px] overflow-hidden cursor-pointer reveal shadow-lg hover:shadow-2xl transition-shadow duration-300">
                    <img src="images/collection-weddings.jpg" alt="Weddings" class="w-full h-full object-cover transition-all duration-1000 group-hover:scale-110">
                    <div class="absolute inset-0 bg-black/20 group-hover:bg-black/40 transition-colors duration-500"></div>
                    <div class="absolute inset-0 flex flex-col items-center justify-center text-center">
                        <h4 class="font-serif text-4xl text-sb-cream mb-4 translate-y-4 group-hover:translate-y-0 transition-transform duration-500">Weddings & Events</h4>
                        <span class="text-sb-cream text-sm tracking-luxury uppercase border-b border-sb-cream pb-1 opacity-0 group-hover:opacity-100 transition-opacity duration-500 delay-100">View Collection</span>
                    </div>
                </a>
                
                 <!-- Card 4 (Full Width) -->
                 <a href="#" class="group relative block h-[350px] overflow-hidden cursor-pointer lg:col-span-3 reveal shadow-lg hover:shadow-2xl transition-shadow duration-300 mt-6">
                    <img src="images/collection-sympathy.jpg" alt="Sympathy" class="absolute inset-0 w-full h-full object-cover transition-all duration-1000 group-hover:scale-105" style="object-position: center 40%;">
                    
                    <div class="absolute inset-0 bg-black/30 group-hover:bg-black/50 transition-colors duration-500"></div>
                    <div class="absolute inset-0 flex flex-col items-center justify-center">
                        <h4 class="font-serif text-5xl text-sb-cream mb-4 translate-y-4 group-hover:translate-y-0 transition-transform duration-500">Sympathy & Tributes</h4>
                        <span class="text-sb-cream text-base tracking-luxury uppercase border-b border-sb-cream pb-1 opacity-0 group-hover:opacity-100 transition-opacity duration-500 delay-100">View Collection</span>
                    </div>
                </a>
            </div>
        </div>
    </section>

    <!-- NEW: Florist's Choice Feature Section -->
    <section class="py-20 bg-sb-black text-sb-cream border-t border-gray-900">
        <div class="container mx-auto px-6">
            <div class="flex flex-col md:flex-row items-center gap-12 lg:gap-24">
                <!-- Text -->
                <div class="w-full md:w-1/2 text-center reveal">
                    <span class="text-sb-gold text-sm tracking-luxury uppercase font-bold mb-4 block">Florist's Choice</span>
                    <h3 class="font-serif text-5xl md:text-6xl mb-6 leading-tight">The Midnight Rose</h3>
                    <p class="text-gray-400 leading-relaxed text-xl font-light mb-8">
                        Our signature bouquet for the season. A dramatic arrangement of deep velvety roses, accented with seasonal foliage and wrapped in our signature black kraft paper. Perfect for making a statement.
                    </p>
                    <button class="shopify-add-btn btn-luxury inline-block border border-sb-cream text-sb-cream px-12 py-4 uppercase tracking-luxury text-xs font-bold" data-shopify-id="10685344973064">
                        Order Now
                    </button>
                </div>
                <!-- Image -->
                <div class="w-full md:w-1/2 reveal delay-200">
                    <div class="relative h-[500px] overflow-hidden shadow-2xl">
                        <img src="images/product-essex-rose.jpg" alt="Florist Choice" class="w-full h-full object-cover transition-transform duration-1000 hover:scale-105">
                        <div class="absolute inset-0 border border-sb-gold/20 pointer-events-none m-4"></div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Best Sellers Slider / Grid -->
    <section class="py-16 md:py-24 bg-sb-cream" id="bestsellers">
        <div class="container mx-auto px-6">
            <div class="flex justify-between items-end mb-10 reveal">
                <h3 class="font-serif text-4xl md:text-5xl text-sb-black">Current Favorites</h3>
                <a href="#" class="hidden md:inline-block text-sm font-bold tracking-luxury border-b border-black pb-1 hover:text-sb-gold hover:border-sb-gold transition-colors">VIEW ALL</a>
            </div>

            <!-- Product Grid with 4. STAGGERED ANIMATIONS -->
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-8">
                <!-- Product 1 -->
                <div class="group reveal delay-100 relative">
                    <div class="relative overflow-hidden mb-6 bg-sb-cream shadow-sm aspect-[4/5] cursor-pointer">
                        <img src="images/product-chelsea.jpg" alt="The Chelsea" class="w-full h-full object-cover transition-all duration-700 group-hover:scale-110 group-hover:opacity-0">
                        <img src="images/product-chelsea.jpg" alt="The Chelsea Detail" class="absolute inset-0 w-full h-full object-cover opacity-0 transition-all duration-700 group-hover:opacity-100 group-hover:scale-110">
                        
                        <button class="shopify-add-btn absolute bottom-0 left-0 right-0 bg-sb-black text-sb-cream py-4 translate-y-full group-hover:translate-y-0 transition-transform duration-300 font-bold tracking-luxury text-xs uppercase hover:bg-zinc-800 z-10"
                            data-shopify-id="10685334683912">
                            Add to Cart
                        </button>
                    </div>
                    <div class="text-center">
                        <h4 class="font-serif text-2xl text-sb-black mb-1">The Chelsea</h4>
                        <p class="text-gray-500 text-sm tracking-wide uppercase mb-2">White Hydrangeas</p>
                        <p class="font-bold text-sb-gold text-xl">£65.00</p>
                    </div>
                </div>

                <!-- Product 2 -->
                <div class="group reveal delay-200">
                    <div class="relative overflow-hidden mb-6 bg-sb-cream shadow-sm aspect-[4/5] cursor-pointer">
                        <img src="images/product-essex-rose.jpg" alt="The Essex Rose" class="w-full h-full object-cover transition-all duration-700 group-hover:scale-110 group-hover:opacity-0">
                        <img src="images/product-essex-rose.jpg" alt="The Essex Rose Detail" class="absolute inset-0 w-full h-full object-cover opacity-0 transition-all duration-700 group-hover:opacity-100 group-hover:scale-110">
                        
                        <button class="shopify-add-btn absolute bottom-0 left-0 right-0 bg-sb-black text-sb-cream py-4 translate-y-full group-hover:translate-y-0 transition-transform duration-300 font-bold tracking-luxury text-xs uppercase hover:bg-zinc-800 z-10"
                            data-shopify-id="10685335339272">
                            Add to Cart
                        </button>
                    </div>
                    <div class="text-center">
                        <h4 class="font-serif text-2xl text-sb-black mb-1">The Essex Rose</h4>
                        <p class="text-gray-500 text-sm tracking-wide uppercase mb-2">Luxury Pink Roses</p>
                        <p class="font-bold text-sb-gold text-xl">£85.00</p>
                    </div>
                </div>

                <!-- Product 3 -->
                <div class="group reveal delay-300">
                    <div class="relative overflow-hidden mb-6 bg-sb-cream shadow-sm aspect-[4/5] cursor-pointer">
                        <img src="images/product-wild-meadow.jpg" alt="Wild Meadow" class="w-full h-full object-cover transition-all duration-700 group-hover:scale-110 group-hover:opacity-0">
                        <img src="images/product-wild-meadow.jpg" alt="Wild Meadow Detail" class="absolute inset-0 w-full h-full object-cover opacity-0 transition-all duration-700 group-hover:opacity-100 group-hover:scale-110">
                        
                        <button class="shopify-add-btn absolute bottom-0 left-0 right-0 bg-sb-black text-sb-cream py-4 translate-y-full group-hover:translate-y-0 transition-transform duration-300 font-bold tracking-luxury text-xs uppercase hover:bg-zinc-800 z-10"
                            data-shopify-id="10685338091784">
                            Add to Cart
                        </button>
                    </div>
                    <div class="text-center">
                        <h4 class="font-serif text-2xl text-sb-black mb-1">Wild Meadow</h4>
                        <p class="text-gray-500 text-sm tracking-wide uppercase mb-2">Seasonal Wildflowers</p>
                        <p class="font-bold text-sb-gold text-xl">£55.00</p>
                    </div>
                </div>

                <!-- Product 4 -->
                <div class="group reveal delay-400">
                    <div class="relative overflow-hidden mb-6 bg-sb-cream shadow-sm aspect-[4/5] cursor-pointer">
                        <img src="images/product-pure-elegance.jpg" alt="Pure Elegance" class="w-full h-full object-cover transition-all duration-700 group-hover:scale-110 group-hover:opacity-0">
                        <img src="images/product-pure-elegance.jpg" alt="Pure Elegance Detail" class="absolute inset-0 w-full h-full object-cover opacity-0 transition-all duration-700 group-hover:opacity-100 group-hover:scale-110">
                        
                        <button class="shopify-add-btn absolute bottom-0 left-0 right-0 bg-sb-black text-sb-cream py-4 translate-y-full group-hover:translate-y-0 transition-transform duration-300 font-bold tracking-luxury text-xs uppercase hover:bg-zinc-800 z-10"
                            data-shopify-id="10685343760648">
                            Add to Cart
                        </button>
                    </div>
                    <div class="text-center">
                        <h4 class="font-serif text-2xl text-sb-black mb-1">Pure Elegance</h4>
                        <p class="text-gray-500 text-sm tracking-wide uppercase mb-2">Orchids & Lilies</p>
                        <p class="font-bold text-sb-gold text-xl">£95.00</p>
                    </div>
                </div>
            </div>
            
            <div class="mt-12 text-center md:hidden">
                 <a href="#" class="inline-block text-sm font-bold tracking-luxury border-b border-black pb-1">VIEW ALL</a>
            </div>
        </div>
    </section>

    <!-- About / Mother Daughter Story -->
    <section class="py-16 md:py-24 overflow-hidden" id="about">
        <div class="container mx-auto px-6">
            <div class="flex flex-col md:flex-row items-center gap-16">
                <!-- Image Grid -->
                <div class="w-full md:w-1/2 relative reveal">
                    <div class="grid grid-cols-2 gap-4">
                        <img src="images/story-arranging.jpg" class="w-full h-64 lg:h-80 object-cover shadow-md grayscale hover:grayscale-0 transition-all duration-700" alt="Florist arranging">
                        <img src="images/story-mother-daughter.jpg" class="w-full h-64 lg:h-80 object-cover mt-8 shadow-md grayscale hover:grayscale-0 transition-all duration-700" alt="Mother Daughter Florists">
                    </div>
                    <div class="absolute -z-10 top-0 left-0 w-full h-full border border-sb-gold/20 transform -translate-x-6 translate-y-6"></div>
                </div>

                <!-- Text Content -->
                <div class="w-full md:w-1/2 md:pl-10 reveal">
                    <h5 class="text-gold-metallic font-bold tracking-luxury text-sm uppercase mb-4">About SB Floristry</h5>
                    <h2 class="font-serif text-4xl md:text-5xl text-sb-black mb-6 leading-tight">Rooted in Family, <br>Bloomed in Passion.</h2>
                    <p class="text-gray-600 mb-6 leading-relaxed font-light text-lg">
                        SB Floristry was born from a shared love of nature between mother and daughter. What started as arranging flowers for family weddings in our Essex kitchen has grown into a full-service floral studio serving the heart of London and our home county.
                    </p>
                    <p class="text-gray-600 mb-10 leading-relaxed font-light text-lg">
                        We believe that flowers are more than just decoration; they are a language of their own. Whether it's a grand wedding installation or a simple "thinking of you" bouquet, we pour our heart into every stem we select.
                    </p>
                    <a href="#about" class="btn-luxury border border-sb-black text-sb-black px-10 py-4 uppercase tracking-luxury text-xs font-bold inline-block">
                        Read Our Full Story
                    </a>
                </div>
            </div>
        </div>
    </section>

    <!-- Weddings Parallax Section -->
    <section class="relative py-32 md:py-40 bg-scroll md:bg-fixed bg-center bg-cover" id="weddings" style="background-image: url('images/weddings-bg.jpg');">
        <div class="absolute inset-0 bg-black/60"></div>
        <div class="container mx-auto px-6 relative z-10 text-center reveal">
            <h2 class="font-serif text-5xl md:text-7xl text-sb-cream mb-8">Weddings & Events</h2>
            <p class="text-gray-200 text-xl md:text-2xl max-w-2xl mx-auto mb-10 font-light leading-relaxed">
                From intimate ceremonies in Essex countryside chapels to grand London ballroom receptions, let us create the floral backdrop for your love story.
            </p>
            <a href="#" class="btn-luxury border border-sb-cream text-sb-cream px-12 py-4 uppercase tracking-luxury text-xs font-bold inline-block">
                Enquire Now
            </a>
        </div>
    </section>

    <!-- Services / Info Strip (Black) -->
    <section class="py-16 md:py-24 bg-sb-black text-sb-cream border-t border-gray-900" id="subscriptions">
        <div class="container mx-auto px-6">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-12 text-center divide-y md:divide-y-0 md:divide-x divide-white/10 reveal">
                <div class="p-6 flex flex-col items-center text-center">
                    <i class="fas fa-shipping-fast text-2xl text-gold-metallic mb-4"></i>
                    <h4 class="font-serif text-2xl mb-3">Delivery Areas</h4>
                    <p class="text-gray-400 text-base font-light leading-relaxed">Proudly serving all of Essex and Greater London postcodes.</p>
                </div>
                <div class="p-6 flex flex-col items-center text-center">
                    <i class="fas fa-calendar-check text-2xl text-gold-metallic mb-4"></i>
                    <h4 class="font-serif text-2xl mb-3">Subscriptions</h4>
                    <p class="text-gray-400 text-base font-light leading-relaxed">Fresh seasonal blooms delivered to your door weekly or monthly.</p>
                </div>
                <div class="p-6 flex flex-col items-center text-center">
                    <i class="fas fa-comments text-2xl text-gold-metallic mb-4"></i>
                    <h4 class="font-serif text-2xl mb-3">Bespoke Requests</h4>
                    <p class="text-gray-400 text-base font-light leading-relaxed">Have a specific vision? Contact us for custom arrangements.</p>
                </div>
            </div>
        </div>
    </section>

    <!-- 6. TESTIMONIALS SECTION -->
    <section class="py-20 bg-sb-cream border-t border-gray-200">
        <div class="container mx-auto px-6 text-center">
            <h3 class="font-serif text-4xl text-sb-black mb-12 reveal">Kind Words</h3>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                <div class="p-8 bg-white shadow-sm reveal delay-100">
                    <div class="text-sb-gold text-2xl mb-4"><i class="fas fa-quote-left"></i></div>
                    <p class="text-gray-600 font-light italic mb-6 text-base">"SB Floristry transformed our venue completely. The seasonal arrangements were breathtaking and better than we imagined."</p>
                    <p class="text-sm font-bold tracking-luxury uppercase text-sb-black">- Rebecca S.</p>
                </div>
                <div class="p-8 bg-white shadow-sm reveal delay-200">
                    <div class="text-sb-gold text-2xl mb-4"><i class="fas fa-quote-left"></i></div>
                    <p class="text-gray-600 font-light italic mb-6 text-base">"The attention to detail is unmatched. Every stem felt curated and special. Highly recommended for any luxury event."</p>
                    <p class="text-sm font-bold tracking-luxury uppercase text-sb-black">- Charlotte & James</p>
                </div>
                <div class="p-8 bg-white shadow-sm reveal delay-300">
                    <div class="text-sb-gold text-2xl mb-4"><i class="fas fa-quote-left"></i></div>
                    <p class="text-gray-600 font-light italic mb-6 text-base">"My subscription box is the highlight of my month. The flowers last so long and the packaging is exquisite."</p>
                    <p class="text-sm font-bold tracking-luxury uppercase text-sb-black">- Eleanor D.</p>
                </div>
            </div>
        </div>
    </section>

    <!-- 7. LUXURY CONTACT FORM -->
    <section class="py-24 bg-sb-black text-sb-cream" id="contact-section">
        <div class="container mx-auto px-6 max-w-4xl">
            <div class="text-center mb-12 reveal">
                <h3 class="font-serif text-4xl md:text-5xl text-sb-cream mb-4">Start Your Floral Journey</h3>
                <p class="font-light text-gray-400">Tell us about your event or custom request.</p>
            </div>
            <form class="space-y-8 reveal" onsubmit="event.preventDefault(); alert('Thank you for your inquiry. We will be in touch shortly.');">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                    <div class="space-y-1">
                        <label class="text-sm font-bold tracking-luxury uppercase text-sb-gold">Name</label>
                        <input type="text" class="w-full bg-transparent border-b border-gray-700 focus:border-sb-gold outline-none py-2 transition-colors text-sb-cream placeholder-gray-600 text-base">
                    </div>
                    <div class="space-y-1">
                        <label class="text-sm font-bold tracking-luxury uppercase text-sb-gold">Email</label>
                        <input type="email" class="w-full bg-transparent border-b border-gray-700 focus:border-sb-gold outline-none py-2 transition-colors text-sb-cream placeholder-gray-600 text-base">
                    </div>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                    <div class="space-y-1">
                        <label class="text-sm font-bold tracking-luxury uppercase text-sb-gold">Event Date (Optional)</label>
                        <input type="date" class="w-full bg-transparent border-b border-gray-700 focus:border-sb-gold outline-none py-2 transition-colors text-sb-cream text-gray-400 text-base">
                    </div>
                    <div class="space-y-1">
                        <label class="text-sm font-bold tracking-luxury uppercase text-sb-gold">Interest</label>
                        <select class="w-full bg-transparent border-b border-gray-700 focus:border-sb-gold outline-none py-2 transition-colors text-sb-cream text-base">
                            <option class="bg-sb-black">Weddings</option>
                            <option class="bg-sb-black">Events</option>
                            <option class="bg-sb-black">Subscription</option>
                            <option class="bg-sb-black">Bespoke Order</option>
                        </select>
                    </div>
                </div>
                <div class="space-y-1">
                    <label class="text-sm font-bold tracking-luxury uppercase text-sb-gold">Message</label>
                    <textarea rows="4" class="w-full bg-transparent border-b border-gray-700 focus:border-sb-gold outline-none py-2 transition-colors text-sb-cream placeholder-gray-600 text-base"></textarea>
                </div>
                <div class="text-center pt-8">
                    <button type="submit" class="btn-luxury border border-sb-cream text-sb-cream px-16 py-4 uppercase tracking-luxury text-xs font-bold inline-block">
                        Send Inquiry
                    </button>
                </div>
            </form>
        </div>
    </section>

    <!-- Instagram / Gallery Feed -->
    <section class="py-0">
        <div class="flex flex-wrap">
            <div class="w-1/2 md:w-1/4 lg:w-1/6 relative group overflow-hidden">
                <img src="images/gallery-1.jpg" class="w-full aspect-square object-cover transition-all duration-700 group-hover:scale-110" alt="Insta 1">
                <div class="absolute inset-0 bg-black/40 opacity-0 group-hover:opacity-100 transition-opacity duration-300 flex items-center justify-center text-sb-cream"><i class="fab fa-instagram text-2xl"></i></div>
            </div>
            <div class="w-1/2 md:w-1/4 lg:w-1/6 relative group overflow-hidden">
                <img src="images/gallery-2.jpg" class="w-full aspect-square object-cover transition-all duration-700 group-hover:scale-110" alt="Insta 2">
                <div class="absolute inset-0 bg-black/40 opacity-0 group-hover:opacity-100 transition-opacity duration-300 flex items-center justify-center text-sb-cream"><i class="fab fa-instagram text-2xl"></i></div>
            </div>
            <div class="w-1/2 md:w-1/4 lg:w-1/6 relative group overflow-hidden">
                <img src="images/gallery-3.jpg" class="w-full aspect-square object-cover transition-all duration-700 group-hover:scale-110" alt="Insta 3">
                <div class="absolute inset-0 bg-black/40 opacity-0 group-hover:opacity-100 transition-opacity duration-300 flex items-center justify-center text-sb-cream"><i class="fab fa-instagram text-2xl"></i></div>
            </div>
            <div class="w-1/2 md:w-1/4 lg:w-1/6 relative group overflow-hidden">
                <img src="images/gallery-4.jpg" class="w-full aspect-square object-cover transition-all duration-700 group-hover:scale-110" alt="Insta 4">
                <div class="absolute inset-0 bg-black/40 opacity-0 group-hover:opacity-100 transition-opacity duration-300 flex items-center justify-center text-sb-cream"><i class="fab fa-instagram text-2xl"></i></div>
            </div>
            <div class="w-1/2 md:w-1/4 lg:w-1/6 relative group overflow-hidden">
                <img src="images/gallery-5.jpg" class="w-full aspect-square object-cover transition-all duration-700 group-hover:scale-110" alt="Insta 5">
                <div class="absolute inset-0 bg-black/40 opacity-0 group-hover:opacity-100 transition-opacity duration-300 flex items-center justify-center text-sb-cream"><i class="fab fa-instagram text-2xl"></i></div>
            </div>
            <div class="w-1/2 md:w-1/4 lg:w-1/6 relative group overflow-hidden">
                <img src="images/gallery-6.jpg" class="w-full aspect-square object-cover transition-all duration-700 group-hover:scale-110" alt="Insta 6">
                <div class="absolute inset-0 bg-black/40 opacity-0 group-hover:opacity-100 transition-opacity duration-300 flex items-center justify-center text-sb-cream"><i class="fab fa-instagram text-2xl"></i></div>
            </div>
        </div>
        <div class="text-center bg-sb-black py-6 border-t border-white/10">
             <a href="#" class="font-serif italic text-sb-cream hover:text-sb-gold transition-colors text-xl">Follow us @SBFloristry</a>
        </div>
    </section>

    <!-- Footer -->
    <footer class="bg-sb-black text-sb-cream pt-20 pb-10" id="contact">
        <div class="container mx-auto px-6">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-12 mb-16 text-center md:text-left">
                <!-- Brand -->
                <div class="col-span-1 md:col-span-1">
                    <h3 class="font-serif text-3xl mb-6">SB <span class="text-gold-metallic italic">Floristry</span></h3>
                    <p class="text-gray-400 text-base leading-relaxed mb-6 font-light">
                        Exquisite floral arrangements for the modern home and events. Handcrafted with love by a mother & daughter team in Essex.
                    </p>
                    <div class="flex justify-center md:justify-start space-x-6">
                        <a href="#" class="text-gray-400 hover:text-sb-gold transition-colors"><i class="fab fa-facebook-f text-lg"></i></a>
                        <a href="#" class="text-gray-400 hover:text-sb-gold transition-colors"><i class="fab fa-instagram text-lg"></i></a>
                        <a href="#" class="text-gray-400 hover:text-sb-gold transition-colors"><i class="fab fa-pinterest-p text-lg"></i></a>
                    </div>
                </div>

                <!-- Quick Links -->
                <div>
                    <h4 class="font-bold tracking-luxury uppercase mb-8 text-sm text-gold-metallic">Shop</h4>
                    <ul class="space-y-4 text-base text-gray-400 font-light">
                        <li><a href="#" class="hover:text-sb-cream hover:underline decoration-sb-gold underline-offset-4 transition-all">Fresh Flowers</a></li>
                        <li><a href="#" class="hover:text-sb-cream hover:underline decoration-sb-gold underline-offset-4 transition-all">Wedding Collection</a></li>
                        <li><a href="#" class="hover:text-sb-cream hover:underline decoration-sb-gold underline-offset-4 transition-all">Subscriptions</a></li>
                        <li><a href="#" class="hover:text-sb-cream hover:underline decoration-sb-gold underline-offset-4 transition-all">Workshops</a></li>
                        <li><a href="#" class="hover:text-sb-cream hover:underline decoration-sb-gold underline-offset-4 transition-all">Gift Cards</a></li>
                    </ul>
                </div>

                <!-- Info -->
                <div>
                    <h4 class="font-bold tracking-luxury uppercase mb-8 text-sm text-gold-metallic">Information</h4>
                    <ul class="space-y-4 text-base text-gray-400 font-light">
                        <li><a href="#" class="hover:text-sb-cream hover:underline decoration-sb-gold underline-offset-4 transition-all">Delivery Policy</a></li>
                        <li><a href="#" class="hover:text-sb-cream hover:underline decoration-sb-gold underline-offset-4 transition-all">Flower Care</a></li>
                        <li><a href="#" class="hover:text-sb-cream hover:underline decoration-sb-gold underline-offset-4 transition-all">About Us</a></li>
                        <li><a href="#" class="hover:text-sb-cream hover:underline decoration-sb-gold underline-offset-4 transition-all">Contact</a></li>
                        <li><a href="#" class="hover:text-sb-cream hover:underline decoration-sb-gold underline-offset-4 transition-all">Privacy Policy</a></li>
                    </ul>
                </div>

                <!-- Newsletter -->
                <div>
                    <h4 class="font-bold tracking-luxury uppercase mb-8 text-sm text-gold-metallic">Stay in Bloom</h4>
                    <p class="text-gray-400 text-base mb-6 font-light">Subscribe for updates on workshops and seasonal offers.</p>
                    <form class="flex border-b border-white/20 pb-2" onsubmit="event.preventDefault(); alert('Thank you for subscribing!');">
                        <input type="email" placeholder="Your email address" class="bg-transparent w-full outline-none text-sb-cream placeholder-gray-500 font-light text-base">
                        <button type="submit" class="text-sb-cream uppercase font-bold text-xs tracking-luxury hover:text-sb-gold transition-colors">Join</button>
                    </form>
                </div>
            </div>

            <div class="border-t border-white/10 pt-8 flex flex-col md:flex-row justify-between items-center text-xs text-gray-500 tracking-widest uppercase">
                <p>&copy; 2024 SB Floristry. All rights reserved.</p>
                <p class="mt-4 md:mt-0">Made with <i class="fas fa-heart text-sb-gold mx-1"></i> in Essex</p>
            </div>
        </div>
    </footer>

    <!-- 8. COOKIE BANNER -->
    <div id="cookie-banner" class="fixed bottom-0 left-0 right-0 bg-sb-black text-sb-cream p-4 z-50 border-t border-gray-800 transform translate-y-full transition-transform duration-500">
        <div class="container mx-auto flex flex-col md:flex-row justify-between items-center gap-4">
            <p class="text-sm font-light text-gray-400 text-center md:text-left">
                We use cookies to ensure you get the best experience on our website. <a href="#" class="text-sb-gold underline">Learn more</a>.
            </p>
            <div class="flex gap-4">
                <button onclick="acceptCookies()" class="bg-sb-gold text-sb-black px-6 py-2 uppercase font-bold text-xs tracking-luxury hover:bg-white transition-colors">
                    Accept
                </button>
                <button onclick="acceptCookies()" class="text-gray-400 hover:text-white text-xs uppercase font-bold tracking-luxury">
                    Dismiss
                </button>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script>
        // SHOPIFY BUY SDK LOGIC
        // -------------------------------------------------------------
        // IMPORTANT: Replace the values below with your actual Shopify credentials.
        // -------------------------------------------------------------
        
        const shopifyConfig = {
            domain: 'sb-floristry.myshopify.com', 
            storefrontAccessToken: '35527e42586bf1abcce2dda69206eec9' 
        };
        
        let debounceTimer;

        // Helper to fetch directly from Storefront API
        async function shopifyFetch(query, variables = {}) {
            try {
                const response = await fetch(`https://${shopifyConfig.domain}/api/2024-01/graphql.json`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-Shopify-Storefront-Access-Token': shopifyConfig.storefrontAccessToken
                    },
                    body: JSON.stringify({ query, variables })
                });
                return await response.json();
            } catch (error) {
                console.error("Shopify Fetch Error:", error);
                throw error;
            }
        }

        // Initialize Cart
        async function initCart() {
            let cartId = localStorage.getItem('shopify_cart_id');
            if (!cartId) return null;
            
            const query = `
                query($id: ID!) {
                  cart(id: $id) {
                    id
                    checkoutUrl
                    totalQuantity
                    note
                    attributes { key value }
                    cost {
                        subtotalAmount { amount currencyCode }
                    }
                    lines(first: 10) {
                        edges {
                            node {
                                id
                                quantity
                                merchandise {
                                    ... on ProductVariant {
                                        id
                                        title
                                        price { amount currencyCode }
                                        image { url }
                                        product { title }
                                    }
                                }
                            }
                        }
                    }
                  }
                }
            `;
            
            const result = await shopifyFetch(query, { id: cartId });
            
            if (result.data && result.data.cart) {
                updateCartUI(result.data.cart);
                // Pre-fill inputs from saved cart data
                const noteInput = document.getElementById('cart-note');
                const dateInput = document.getElementById('delivery-date');
                
                if (noteInput && result.data.cart.note) {
                    noteInput.value = result.data.cart.note;
                }
                
                if (dateInput && result.data.cart.attributes) {
                    const dateAttr = result.data.cart.attributes.find(a => a.key === 'Requested Delivery Date');
                    if (dateAttr) dateInput.value = dateAttr.value;
                }
                
                return result.data.cart;
            } else {
                localStorage.removeItem('shopify_cart_id');
                return null;
            }
        }
        
        // Create a new cart
        async function createCart() {
            const query = `mutation { cartCreate { cart { id checkoutUrl } } }`;
            const result = await shopifyFetch(query);
            if (result.data && result.data.cartCreate && result.data.cartCreate.cart) {
                const cart = result.data.cartCreate.cart;
                localStorage.setItem('shopify_cart_id', cart.id);
                return cart;
            }
            throw new Error("Failed to create cart");
        }

        // Update Cart Attributes (Note & Date)
        async function updateCartAttributes(note, date) {
            const cartId = localStorage.getItem('shopify_cart_id');
            if (!cartId) return;

            const query = `
                mutation updateCart($cartId: ID!, $note: String, $attributes: [AttributeInput!]) {
                    cartNoteUpdate(cartId: $cartId, note: $note) {
                        cart { id }
                    }
                    cartAttributesUpdate(cartId: $cartId, attributes: $attributes) {
                        cart { id }
                    }
                }
            `;

            // Prepare attributes array. Only add date if it exists.
            const attributes = [];
            if (date) {
                attributes.push({ key: "Requested Delivery Date", value: date });
            }

            try {
                await shopifyFetch(query, {
                    cartId: cartId,
                    note: note || "", 
                    attributes: attributes
                });
                console.log("Cart updated with note/date");
                return true;
            } catch (e) {
                console.error("Failed to update attributes", e);
                return false;
            }
        }

        // Handle Date/Note input changes with validation
        function handleCartInputUpdate() {
            const note = document.getElementById('cart-note')?.value;
            const dateInput = document.getElementById('delivery-date');
            const dateError = document.getElementById('date-error');
            
            if (dateInput) {
                const selectedDate = new Date(dateInput.value);
                const day = selectedDate.getDay(); // 0 = Sunday
                
                // Sunday check
                if (day === 0) {
                    dateError.classList.remove('hidden');
                    dateInput.value = ''; // Clear input
                    return; // Stop update
                } else {
                    dateError.classList.add('hidden');
                }
            }

            // Debounce the API call
            clearTimeout(debounceTimer);
            debounceTimer = setTimeout(() => {
                updateCartAttributes(note, dateInput?.value);
            }, 500); 
        }

        // SMART ADD TO CART: Converts Product ID -> Variant ID -> Add to Cart
        async function addToCart(rawProductId) {
            try {
                // 1. Convert raw ID (12345) to Shopify Global ID (gid://shopify/Product/12345)
                // We use btoa() to encode it to Base64 as required by the SDK
                const globalProductId = btoa(`gid://shopify/Product/${rawProductId}`);

                // 2. Fetch the product to get the correct Variant ID
                const productQuery = `
                    query($id: ID!) {
                      product(id: $id) {
                        variants(first: 1) {
                          nodes {
                            id
                          }
                        }
                      }
                    }
                `;
                
                let productResult = await shopifyFetch(productQuery, { id: globalProductId }); // Fixed to use globalProductId
                
                if (!productResult.data || !productResult.data.product) {
                     // Fallback logic for raw GIDs
                     const rawGid = `gid://shopify/Product/${rawProductId}`;
                     productResult = await shopifyFetch(productQuery, { id: rawGid });
                     
                     if (!productResult.data || !productResult.data.product) {
                        throw new Error("Product not found");
                     }
                }
                
                const variantId = productResult.data.product.variants.nodes[0].id;
                
                // 3. Get or Create Cart
                let cart = await initCart();
                if (!cart) {
                    cart = await createCart();
                }
                
                // 4. Add Line Item
                const addLineQuery = `
                    mutation($cartId: ID!, $lines: [CartLineInput!]!) {
                      cartLinesAdd(cartId: $cartId, lines: $lines) {
                        cart {
                          id
                          totalQuantity
                          checkoutUrl
                          cost { subtotalAmount { amount currencyCode } }
                          lines(first: 10) {
                            edges {
                                node {
                                    id
                                    quantity
                                    merchandise {
                                        ... on ProductVariant {
                                            id
                                            title
                                            price { amount currencyCode }
                                            image { url }
                                            product { title }
                                        }
                                    }
                                }
                            }
                        }
                        }
                      }
                    }
                `;
                
                const addResult = await shopifyFetch(addLineQuery, {
                    cartId: cart.id,
                    lines: [{ merchandiseId: variantId, quantity: 1 }]
                });
                
                if (addResult.data && addResult.data.cartLinesAdd && addResult.data.cartLinesAdd.cart) {
                    updateCartUI(addResult.data.cartLinesAdd.cart);
                    if (window.openCart) window.openCart();
                    return true;
                }
                return false;

            } catch (e) {
                console.error("Error adding to cart:", e);
                alert("Could not add item. Please check the Product ID in your code.");
                return false;
            }
        }

        async function updateLineItem(lineId, quantity) {
            const cartId = localStorage.getItem('shopify_cart_id');
            if(!cartId) return;

            const query = `
                mutation($cartId: ID!, $lines: [CartLineUpdateInput!]!) {
                    cartLinesUpdate(cartId: $cartId, lines: $lines) {
                        cart {
                            id
                            totalQuantity
                            checkoutUrl
                            cost { subtotalAmount { amount currencyCode } }
                            lines(first: 10) {
                                edges {
                                    node {
                                        id
                                        quantity
                                        merchandise {
                                            ... on ProductVariant {
                                                id
                                                title
                                                price { amount currencyCode }
                                                image { url }
                                                product { title }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            `;
            
            const result = await shopifyFetch(query, {
                cartId: cartId,
                lines: [{ id: lineId, quantity: quantity }]
            });

            if(result.data && result.data.cartLinesUpdate) {
                updateCartUI(result.data.cartLinesUpdate.cart);
            }
        }

        async function removeLineItem(lineId) {
             const cartId = localStorage.getItem('shopify_cart_id');
            if(!cartId) return;

            const query = `
                mutation($cartId: ID!, $lineIds: [ID!]!) {
                    cartLinesRemove(cartId: $cartId, lineIds: $lineIds) {
                        cart {
                            id
                            totalQuantity
                            checkoutUrl
                            cost { subtotalAmount { amount currencyCode } }
                            lines(first: 10) {
                                edges {
                                    node {
                                        id
                                        quantity
                                        merchandise {
                                            ... on ProductVariant {
                                                id
                                                title
                                                price { amount currencyCode }
                                                image { url }
                                                product { title }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            `;
            
            const result = await shopifyFetch(query, {
                cartId: cartId,
                lineIds: [lineId]
            });

            if(result.data && result.data.cartLinesRemove) {
                updateCartUI(result.data.cartLinesRemove.cart);
            }
        }

        function updateCartUI(cart) {
            // Update Badge
            const badge = document.getElementById('cart-count');
            if (badge) {
                badge.innerText = cart.totalQuantity;
                badge.classList.remove('opacity-0');
                if(cart.totalQuantity > 0) {
                    badge.classList.add('scale-150');
                    setTimeout(() => badge.classList.remove('scale-150'), 200);
                }
            }

            // Update Side Cart HTML
            const cartContainer = document.getElementById('cart-items-container');
            const subtotalEl = document.getElementById('cart-subtotal');
            const checkoutBtn = document.getElementById('checkout-btn');
            const upsellSection = document.getElementById('upsell-section');
            const shippingBar = document.getElementById('shipping-bar');
            const shippingMessage = document.getElementById('shipping-message');
            const cartExtras = document.getElementById('cart-extras'); // NEW

            if (cartContainer && cart.cost) {
                 const amount = parseFloat(cart.cost.subtotalAmount.amount);
                 if (subtotalEl) subtotalEl.innerText = `£${amount.toFixed(2)}`;
                 
                 // Show/Hide Upsell and Extras based on items
                 const hasItems = cart.lines.edges.length > 0;

                 if (hasItems && upsellSection) {
                     upsellSection.classList.remove('hidden');
                 } else if (upsellSection) {
                     upsellSection.classList.add('hidden');
                 }

                 if (hasItems && cartExtras) {
                    cartExtras.classList.remove('hidden');
                 } else if (cartExtras) {
                    cartExtras.classList.add('hidden');
                 }

                 // Update Free Delivery Bar
                 const freeDeliveryThreshold = 60;
                 if (shippingBar && shippingMessage) {
                     let percentage = (amount / freeDeliveryThreshold) * 100;
                     if (percentage > 100) percentage = 100;
                     
                     shippingBar.style.width = `${percentage}%`;
                     
                     if (amount >= freeDeliveryThreshold) {
                         shippingBar.classList.add('bg-green-500');
                         shippingBar.classList.remove('bg-sb-gold');
                         shippingMessage.innerHTML = 'You have unlocked <span class="text-green-600">Free Delivery!</span>';
                     } else {
                         shippingBar.classList.add('bg-sb-gold');
                         shippingBar.classList.remove('bg-green-500');
                         const remaining = (freeDeliveryThreshold - amount).toFixed(2);
                         shippingMessage.innerHTML = `Spend <span class="text-sb-gold">£${remaining}</span> more for Free Delivery`;
                     }
                 }
            }

            // Bind Checkout Button - UPDATED LOGIC
            if (checkoutBtn) {
                // Clone button to remove old listeners if any
                const newBtn = checkoutBtn.cloneNode(true);
                checkoutBtn.parentNode.replaceChild(newBtn, checkoutBtn);
                
                // If cart empty, redirect to shop. Else checkout.
                if (cart.lines.edges.length === 0) {
                     newBtn.innerText = "Browse Seasonal Collection";
                     newBtn.onclick = () => {
                         window.closeCart();
                         document.getElementById('shop').scrollIntoView({ behavior: 'smooth' });
                     };
                } else if (cart.checkoutUrl) {
                    newBtn.innerText = "Proceed to Checkout";
                    
                    newBtn.onclick = async () => {
                        const noteInput = document.getElementById('cart-note');
                        const dateInput = document.getElementById('delivery-date');
                        const note = noteInput?.value.trim();
                        const date = dateInput?.value;

                        // 1. Mandatory Date Check
                        if (!date) {
                            alert("Please select a delivery date to proceed.");
                            dateInput.classList.add('border-red-500');
                            dateInput.focus();
                            // Remove red border on next input
                            dateInput.addEventListener('input', () => {
                                dateInput.classList.remove('border-red-500');
                            }, { once: true });
                            return;
                        }

                        // 2. Gift Message Reminder (Soft Check)
                        if (!note) {
                            const confirmNoMessage = confirm("You haven't written a gift message. Are you sure you want to proceed without one?");
                            if (!confirmNoMessage) {
                                noteInput.focus();
                                return;
                            }
                        }

                        // Proceed if checks pass
                        const originalText = newBtn.innerText;
                        newBtn.innerText = "Processing...";
                        
                        // Force update of Note and Date before redirecting
                        await updateCartAttributes(note, date);
                        
                        // Redirect
                        window.location.href = cart.checkoutUrl;
                    };
                }
            }

            // Render Items
            if (cartContainer) {
                if (cart.lines.edges.length === 0) {
                    cartContainer.innerHTML = `
                        <div class="flex flex-col items-center justify-center h-full text-gray-400 space-y-4">
                            <i class="fas fa-shopping-basket text-3xl text-sb-gold opacity-50"></i>
                            <p>Your cart is empty.</p>
                        </div>
                    `;
                } else {
                    cartContainer.innerHTML = cart.lines.edges.map(edge => {
                        const item = edge.node;
                        return `
                            <div class="flex items-center gap-4 mb-6 border-b border-gray-100 pb-4">
                                <div class="w-20 h-24 flex-shrink-0 bg-gray-50">
                                    <img src="${item.merchandise.image?.url || ''}" class="w-full h-full object-cover loaded" style="opacity: 1;">
                                </div>
                                <div class="flex-1">
                                    <h4 class="font-serif text-lg text-sb-black leading-tight mb-1">${item.merchandise.product.title}</h4>
                                    <p class="text-xs text-gray-500 mb-2">£${item.merchandise.price.amount}</p>
                                    <div class="flex items-center gap-4">
                                        <div class="flex items-center border border-gray-200">
                                            <button onclick="updateLineItem('${item.id}', ${item.quantity - 1})" class="px-2 py-1 text-gray-500 hover:text-sb-black">-</button>
                                            <span class="px-2 text-xs font-bold">${item.quantity}</span>
                                            <button onclick="updateLineItem('${item.id}', ${item.quantity + 1})" class="px-2 py-1 text-gray-500 hover:text-sb-black">+</button>
                                        </div>
                                        <button onclick="removeLineItem('${item.id}')" class="text-xs text-gray-400 hover:text-red-500 underline">Remove</button>
                                    </div>
                                </div>
                            </div>
                        `;
                    }).join('');
                }
            }
        }

        // Global function refs for inline HTML onclicks
        window.updateLineItem = updateLineItem;
        window.removeLineItem = removeLineItem;

        // DOM Elements & Event Listeners - Wrapped in DOMContentLoaded for safety
        document.addEventListener('DOMContentLoaded', () => {
            
            // Side Cart Open/Close Logic
            const sideCart = document.getElementById('side-cart');
            const sideCartOverlay = document.getElementById('side-cart-overlay');
            const closeCartBtn = document.getElementById('close-cart-btn');
            const cartIconBtn = document.getElementById('cart-icon-btn');
            const cartNote = document.getElementById('cart-note');
            const deliveryDate = document.getElementById('delivery-date');

            // Date Picker Init
            if (deliveryDate) {
                const today = new Date().toISOString().split('T')[0];
                deliveryDate.setAttribute('min', today);
                deliveryDate.addEventListener('change', handleCartInputUpdate);
            }

            if (cartNote) cartNote.addEventListener('input', handleCartInputUpdate);
            
            window.openCart = function() {
                if (sideCartOverlay && sideCart) {
                    sideCartOverlay.classList.remove('hidden');
                    setTimeout(() => {
                        sideCartOverlay.classList.remove('opacity-0');
                        sideCart.classList.remove('translate-x-full');
                    }, 10);
                }
            };

            window.closeCart = function() {
                if (sideCart && sideCartOverlay) {
                    sideCart.classList.add('translate-x-full');
                    sideCartOverlay.classList.add('opacity-0');
                    setTimeout(() => {
                        sideCartOverlay.classList.add('hidden');
                    }, 300);
                }
            };

            if (cartIconBtn) cartIconBtn.addEventListener('click', window.openCart);
            if (closeCartBtn) closeCartBtn.addEventListener('click', window.closeCart);
            if (sideCartOverlay) sideCartOverlay.addEventListener('click', window.closeCart);
            
            // Event Listeners for Add Buttons
            document.querySelectorAll('.shopify-add-btn').forEach(btn => {
                btn.addEventListener('click', async (e) => {
                    const id = btn.getAttribute('data-shopify-id');
                    const originalText = btn.innerText;
                    btn.innerText = "Adding...";
                    btn.classList.add('bg-sb-gold', 'text-sb-black', 'border-sb-gold');
                    btn.classList.remove('bg-sb-black', 'text-sb-cream', 'border-sb-black');
                    
                    if (id) {
                        await addToCart(id);
                        btn.innerText = "Added";
                    }
                    setTimeout(() => {
                        btn.innerText = originalText;
                        btn.classList.remove('bg-sb-gold', 'text-sb-black', 'border-sb-gold');
                        btn.classList.add('bg-sb-black', 'text-sb-cream', 'border-sb-black');
                    }, 2000);
                });
            });

            // Mobile Menu Logic
            const mobileMenuBtn = document.getElementById('mobile-menu-btn');
            const closeMenuBtn = document.getElementById('close-menu-btn');
            const mobileMenu = document.getElementById('mobile-menu');
            const menuLinks = mobileMenu ? mobileMenu.querySelectorAll('a') : [];

            function toggleMenu() {
                if (!mobileMenu) return;
                const isClosed = mobileMenu.classList.contains('-translate-x-full');
                if (isClosed) {
                    mobileMenu.classList.remove('-translate-x-full');
                    document.body.style.overflow = 'hidden'; 
                } else {
                    mobileMenu.classList.add('-translate-x-full');
                    document.body.style.overflow = 'auto'; 
                }
            }

            if (mobileMenuBtn) mobileMenuBtn.addEventListener('click', toggleMenu);
            if (closeMenuBtn) closeMenuBtn.addEventListener('click', toggleMenu);
            menuLinks.forEach(link => link.addEventListener('click', toggleMenu));

            // Scroll Animation Observer
            const observerOptions = { root: null, rootMargin: '100px', threshold: 0.1 };
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) entry.target.classList.add('active');
                });
            }, observerOptions);
            document.querySelectorAll('.reveal').forEach((el) => observer.observe(el));

            // IMAGE FADE IN LOGIC
            function handleImageLoad(img) { img.classList.add('loaded'); }
            document.querySelectorAll('img').forEach(img => {
                if (img.complete) handleImageLoad(img);
                else img.addEventListener('load', () => handleImageLoad(img));
            });

            // Cookie Banner Logic
            window.acceptCookies = function() {
                const banner = document.getElementById('cookie-banner');
                if (banner) {
                    banner.classList.remove('translate-y-0');
                    banner.classList.add('translate-y-full');
                    localStorage.setItem('cookiesAccepted', 'true');
                }
            }

            if (!localStorage.getItem('cookiesAccepted')) {
                setTimeout(() => {
                    const banner = document.getElementById('cookie-banner');
                    if (banner) {
                        banner.classList.remove('translate-y-full');
                        banner.classList.add('translate-y-0');
                    }
                }, 2000); 
            }

            // Init Cart
            initCart();
        });
    </script>
</body>
</html>
